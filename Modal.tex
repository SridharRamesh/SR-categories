\filestart

\section{Modal logic}
\subsection{Preview}
In this chapter, we will show how to interpret the $\Box$ operator of traditional modal logic in the context of introspective theories (or their generalizations). In particular, after defining the $\Box$ operator in this context, we observe in this chapter how it satisfies the rules of the modal logic K4.

\subsection{The box operator}
The following notation will be very convenient for us going forward. It is also suggestive of connections with modal logic we will eventually explore:

Let $\langle T, C \rangle$ be a locally introspective theory.

\TODOinline{Convention about using P(c) instead of P(t, c) to note t-indexed sets given by a doubly-indexed set}

We say a presheaf on $C$ is locally $T$-small if the map from its total space of elements to $\Ob(C)$ has $T$-small fibers. In other words, $P(c)$ is represented by an object of $T/t$ for each $t$-definable object $c$ of $C$. Put another way, such a presheaf is a $T$-indexed functor between the $T$-indexed categories $\op{C}$ and $T/-$.

Note that the category of locally $T$-small presheaves on $C$ is itself a $T$-indexed lexcategory. We will refer to this as $\Psh{C}$. (In more detail, the $T$-indexed category $C$ gives rise in an obvious way, by reversing arrows, to another $T$-indexed category $\op{C}$. We then have that the two $T$-indexed categories $\op{C}$ and $T/-$ are objects of $\Cat^{\op{T}}$. But $\Cat^{\op{T}}$ is a cartesian closed 2-category (in much the same way that $\Set^{\op{T}}$ is a cartesian closed category, at least when $\Set$ or $\Cat$ are interpreted expansively enough to include sets or categories of comparable size to $T$), and thus we can form within it the exponential object for $T/-$ raised to the power $\op{C}$. This exponential object is the $T$-indexed category we call $\Psh{C}$.)

\TODOinline{The above probably belongs in the Preliminaries on doubly-indexed sets.}

Thus, we have three $T$-indexed lexcategories of note: $T$ itself (considered as a $T$-indexed category through the self-indexing $T/-$), $C$, and $\Psh{C}$.

Between these, we also have a cycle of $T$-indexed lexfunctors, like so:

\[\begin{tikzcd}
	&& {T/-} \\
	\\
	C &&&& {\Psh{C}}
	\arrow["\introF"', from=1-3, to=3-1]
	\arrow["{c \; \mapsto \Hom_{C}(-, c)}"', from=3-1, to=3-5]
	\arrow["{P \mapsto P(1)}"', from=3-5, to=1-3]
\end{tikzcd}\]

Here, the bottom arrow is the Yoneda embedding, sending each object of $C$ to the corresponding representable presheaf. The right arrow takes a presheaf on $C$ to its evaluation at the terminal object of $C$; that is, to its global elements. The left arrow is the $\introF$ which is part of the structure of an introspective theory.

\begin{observation}\label{SliceBoxIsAspectBox}
The $t$-aspect of the above triangle of indexed lexfunctors is the same as the global aspect of the same triangle of indexed lexfunctors relative to the slice introspective theory $T/t$ given by \magicref{IntrospSlice}. \TODOinline{Word this better and prove it.}
\end{observation}

\begin{definition}\label{BoxDefn}
In general, we will write $\Box$ for a roundtrip around this diagram, starting from any of its three nodes.

Thus, we will write $\Box$ for the $T$-indexed lexfunctor from $T$ to itself given by $t \mapsto \Hom_C(1, \introF(t))$.

We will ALSO write $\Box$ for the $T$-indexed lexfunctor from $C$ to itself given by $c \mapsto \introF(\Hom_C(1, c))$.

And we will ALSO write $\Box$ for the $T$-indexed lexfunctor from $\Psh{C}$ to $\Psh{C}$, which sends the presheaf $P$ to the presheaf represented by $\introF(P(1))$.

When we want to clarify precisely the domain we are operating on, we will write names such as $\Box_{T/-}$, $\Box_C$, or $\Box_{\Psh{C}}$, as appropriate.

As the Yoneda embedding is naturally thought of as the inclusion of a full sub-lexcategory, identifying $C$ with the corresponding representable presheaves within $\Psh{C}$, we may also think of $\Box_{\Psh{C}}$ as a $T$-indexed lexfunctor from $\Psh{C}$ to $C$. That is, as the composition of merely the top two arrows above.
\end{definition}

The above was all discussed for $T$, $C$, and $\Psh{C}$ considered as $T$-indexed lexcategories, but this all (and the rest of this chapter as well) descends to corresponding structure on their global aspects as well. Keep in mind, in the global aspect context, $\introF$ is the same as $\introS$, so wherever in the above we discussed $\introF$, a corresponding statement holds as well for $\introS$, when considering just the global aspect. We may write $\Box_{T}$ for the global aspect of $\Box_{T/-}$ (which is an endolexfunctor of $T$).

\bigskip
\begin{remark}\label{BoxNotationSmallnessConcerns}
The reason we restricted attention here to locally $T$-small presheaves, rather than arbitrary presheaves, is so that the map $P \mapsto P(1)$ can indeed be taken as always landing back within $T$ and not within $T$-indexed sets more generally.

Similarly, the reason we restricted attention to locally introspective theories (i.e., the case where $C$ is locally $T$-small) and not to pre-introspective theories more generally is so that the Yoneda embedding $c \mapsto \Hom_C(-, c)$ does indeed land within the locally $T$-small presheaves, rather than arbitrary presheaves.
\end{remark}

\subsection{Box preservation}
Note that, having set up these various notions of $\Box$, we find that $\Box$ and each of the maps in the diagram \quote{commutes} in the appropriate sense; that is, they can be seen as preserving each other.

For example, $\introF$ preserves $\Box$, in that both $\introF(\Box(-))$ and $\Box(\introF(-))$ yield the same $T$-indexed functor from the self-indexing of $T$ to $C$. This is readily seen by unwinding their definitions: These are both $\introF(\Hom_C(1, \introF(-)))$.

We also have that taking $\Hom_C(1, -)$ preserves $\Box$ in the same way. $\Hom_C(1, \Box(-)) = \Box(\Hom_C(1, -)) = \Hom_C(1, \introF(\Hom_C(1, -)))$. More generally, consider the map $G$ which assigns to every locally $T$-small presheaf $P$ upon $C$ its object of global elements $P(1)$. Then $G$ preserves $\Box$ in the same way: $G(\Box P) = \Box(G(P)) = \Hom_C(1, \introF(P(1)))$.

Given object $c$ of $C$, and locally $T$-small presheaf $P$ on $C$, we will write $c \implies P$ to indicate the exponential presheaf $P^c$. That is, the presheaf $P(- \times c)$. We may also write $c \implies d$ where $d$ is an object of $C$ as well, to mean $c \implies P$ for the presheaf $P = \Hom_C(-, d)$ represented by $d$. Thus, $c \implies d$ is the presheaf $\Hom_C(- \times c, d)$.

Note that for any locally $T$-small presheaf $P$ on $C$ and object $c$ of $C$, we have that $P(c)$ can be identified with the presheaf $c \implies P$ evaluated at $1$, and thus $\introF(P(c))$ can be identified with $\Box(c \implies P)$. In particular, by considering the case when $P$ is represented by object $d$, we find that $\Box(c \implies d)$ is naturally identifiable with $\introF(\Hom_C(c, d))$.

\subsection{Modal logic and axiom 4}
The choice of this $\Box$ notation for these purposes is meant to convey an analogy with the $\Box$ operator of modal logic, and in particular, with the provability operator of provability logic. We will explore this more in later remarks.

The key point here is that the rules of the $\Box$ operator in a Kripke normal modal logic are essentially the rules of a lex endofunctor on a lexcategory, and any of our $\Box$ operators is certainly lex as a composite of lex functors.

Furthermore, each of our $\Box$ operators comes with a natural transformation from $\Box$ to $\Box \Box$ corresponding to the so-called 4 axiom $\Box A \vdash \Box \Box A$ in modal logic.

For the $\Box$ operator on $T$ this is clear, as the natural transformation $\introN$ from identity to $\Box$ encodes the even stronger property $t \vdash \Box t$. The 4 axiom is the special case where $t$ here is of the form $\Box A$.

\TODOinline{Address that $\introN$ should be read as an indexed operation acting on each aspect of $T/-$.}

% https://q.uiver.app/?q=WzAsMyxbMiwwLCJULy0iXSxbMCwyLCJDIl0sWzQsMiwiXFxQc2h7Q30iXSxbMCwxLCJcXGludHJvRiIsMl0sWzEsMiwiYyBcXG1hcHN0byBcXEhvbV9DKC0sIGMpIiwyXSxbMiwwLCJQIFxcbWFwc3RvIFAoMSkiLDJdLFswLDQsIlxcaW50cm9OIDogXFxpZF9UIFxcdG8gXFxCb3hfVCIsMSx7InNob3J0ZW4iOnsidGFyZ2V0IjoyMH19XV0=
\[\begin{tikzcd}
	&& {T/-} \\
	\\
	C &&&& {\Psh{C}}
	\arrow["\introF"', from=1-3, to=3-1]
	\arrow[""{name=0, anchor=center, inner sep=0}, "{c \mapsto \Hom_C(-, c)}"', from=3-1, to=3-5]
	\arrow["{P \mapsto P(1)}"', from=3-5, to=1-3]
	\arrow["{\introN : \id_T \to \Box_T}"{description}, shorten >=7pt, Rightarrow, from=1-3, to=0]
\end{tikzcd}\]

We do not have such a strong natural transformation from identity to $\Box$ as acting on the other corners of the triangle ($C$ or $\Psh{C}$). However, by taking the natural transformation from $t$ to $\Box_T t$, whiskering it on both sides along the trips from any other corner of the triangle into and out of $T$, and then applying the commutativity of $\Box$ with each leg of the triangle, we get a natural transformation from $\Box$ to $\Box \Box$ at each other corner of the triangle as well.

(The general principle here is that, given morphisms $f$ and $g$ between the same pair of objects in opposite directions, composing with $f$ on one side and $g$ on the other turns $(gf)^n$ into $(fg)^{n + 1}$, and thus whiskering in this way turns a natural transformation $: (gf)^n \to (gf)^m$ into a natural transformation $: (fg)^{n + 1} \to (fg)^{m + 1}$)

% https://q.uiver.app/?q=WzAsOCxbMSwwLCJcXFBzaHtDfSJdLFsyLDAsIlQiXSxbMywxLCJDIl0sWzQsMSwiXFxQc2h7Q30iXSxbNSwwLCJUIl0sWzMsMF0sWzYsMCwiQyJdLFswLDAsIkMiXSxbMCwxXSxbMSwyXSxbMiwzXSxbMyw0XSxbMSw0LCJcXGlkX1QiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDZdLFsyLDYsIlxcQm94X0MiLDIseyJjdXJ2ZSI6NX1dLFs3LDBdLFs3LDYsIlxcQm94X0MiLDAseyJjdXJ2ZSI6LTV9XSxbNywyLCJcXEJveF9DIiwyXSxbMTIsMTAsIlxcaW50cm9OIiwyLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwLCJ0YXJnZXQiOjIwfX1dXQ==
\[\begin{tikzcd}
	C & {\Psh{C}} & T & {} && T & C \\
	&&& C & {\Psh{C}}
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-3, to=2-4]
	\arrow[""{name=0, anchor=center, inner sep=0}, from=2-4, to=2-5]
	\arrow[from=2-5, to=1-6]
	\arrow[""{name=1, anchor=center, inner sep=0}, "{\id_T}", Rightarrow, no head, from=1-3, to=1-6]
	\arrow[from=1-6, to=1-7]
	\arrow["{\Box_C}"', curve={height=30pt}, from=2-4, to=1-7]
	\arrow[from=1-1, to=1-2]
	\arrow["{\Box_C}", curve={height=-30pt}, from=1-1, to=1-7]
	\arrow["{\Box_C}"', from=1-1, to=2-4]
	\arrow["\introN"', shorten <=4pt, shorten >=4pt, Rightarrow, from=1, to=0]
\end{tikzcd}\]

% https://q.uiver.app/?q=WzAsNyxbMCwwLCJcXFBzaHtDfSJdLFsxLDAsIlQiXSxbMiwxLCJDIl0sWzMsMSwiXFxQc2h7Q30iXSxbNCwwLCJUIl0sWzIsMF0sWzUsMCwiQyJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFsxLDQsIlxcaWRfVCIsMCx7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsNl0sWzMsNiwiXFxCb3hfe1xcUHNoe0N9fSIsMl0sWzAsMywiXFxCb3hfe1xcUHNoe0N9fSIsMix7ImN1cnZlIjo1fV0sWzAsNiwiXFxCb3hfe1xcUHNoe0N9fSIsMCx7ImN1cnZlIjotNX1dLFsxMSw5LCJcXGludHJvTiIsMix7InNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH19XV0=
\[\begin{tikzcd}
	{\Psh{C}} & T & {} && T & C \\
	&& C & {\Psh{C}}
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center, inner sep=0}, from=2-3, to=2-4]
	\arrow[from=2-4, to=1-5]
	\arrow[""{name=1, anchor=center, inner sep=0}, "{\id_T}", Rightarrow, no head, from=1-2, to=1-5]
	\arrow[from=1-5, to=1-6]
	\arrow["{\Box_{\Psh{C}}}"', from=2-4, to=1-6]
	\arrow["{\Box_{\Psh{C}}}"', curve={height=30pt}, from=1-1, to=2-4]
	\arrow["{\Box_{\Psh{C}}}", curve={height=-30pt}, from=1-1, to=1-6]
	\arrow["\introN"', shorten <=4pt, shorten >=4pt, Rightarrow, from=1, to=0]
\end{tikzcd}\]

(In the above two diagrams, all parallel paths commute except where an explicit natural transformation is noted, and all unmarked edges are the corresponding of the three edges along our triangle. In the diagram illustrating axiom 4 for $\Box_{\Psh{C}}$, we note that we can think of the codomain of $\Box_{\Psh{C}}$ as either $\Psh{C}$ or more narrowly its full subcategory $C$.)

Thus, our $\Box$ follows all the rules of the modal logic K4, in each of these contexts. Later, we shall see that the general logic followed by $\Box_C$ in a locally introspective theory is conversely no stronger than K4, while in an introspective theory, it is the modal logic GL. Indeed, in the very next chapter we will see how in an introspective theory we get the last ingredient for the modal logic GL, \Loeb/'s theorem.

\sTODOinline{Citation to Boolos and other modal logic references at some point}

\sTODOinline{Add commentary on how our box is actually a bifunctor instead of a single functor, as we do not presume cartesian closure. Add commentary on the case where we have cartesian closure, including how this reduces to a single box functor (either for the introspective theory or geminal category case), and including the relationship with double negation/Booleanness when Lob's theorem is introduced}

\subsection{As applied to our archetypal examples}
\TODO

\subsection{Recap}
We have defined the $\Box$ operator in the context of locally introspective theories, and shown that it satisfies the rules of K4 modal logic.

In the next chapter, we will show that in an introspective theory, the $\Box$ furthermore satisfies the \Loeb/ property of the modal logic GL (aka, \quote{provability logic}).

Later, we shall also show the converses making these results tight: The rules which hold in general of the $\Box$ operator in a locally introspective theory are no stronger than (thus, precisely equal to) those of K4, while the rules which hold in general of the $\Box$ operator in an introspective theory are no stronger than (thus, precisely equal to) those of GL.

\fileend