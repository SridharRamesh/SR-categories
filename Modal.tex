\filestart

\section{Modal logic}
\subsection{The box operator}
The following notation will be very convenient for us going forward. It is also suggestive of connections with modal logic we will eventually explore.

Let $\langle T, C \rangle$ be a locally introspective theory.

We say a presheaf on $C$ is locally $T$-small if the map from its total space of elements to $\Ob(C)$ has $T$-small fibers. In other words, $P(c)$ is represented by an object of $T/t$ for each $t$-definable object $c$ of $C$. Put another way, such a presheaf is a $T$-indexed functor between the $T$-indexed categories $\op{C}$ and $T/-$.

Note that the category of locally $T$-small presheaves on $C$ is itself a $T$-indexed lexcategory. We will refer to this as $\Psh{C}$. (In more detail, the $T$-indexed category $C$ gives rise in an obvious way, by reversing arrows, to another $T$-indexed category $\op{C}$. We then have that the two $T$-indexed categories $\op{C}$ and $T/-$ are objects of $\Cat^{\op{T}}$. But $\Cat^{\op{T}}$ is a cartesian closed 2-category (in much the same way that $\Set^{\op{T}}$ is a cartesian closed category, at least when $\Set$ or $\Cat$ are interpreted expansively enough to include sets or categories of comparable size to $T$), and thus we can form within it the exponential object for $T/-$ raised to the power $\op{C}$. This exponential object is the $T$-indexed category we call $\Psh{C}$.)

Thus, we have three $T$-indexed lexcategories of note: $T$ itself (considered as a $T$-indexed category through the self-indexing $T/-$), $C$, and $\Psh{C}$.

Between these, we also have a cycle of $T$-indexed lexfunctors, like so:

\[\begin{tikzcd}
	&& {T/-} \\
	\\
	C &&&& {\Psh{C}}
	\arrow["\introF"', from=1-3, to=3-1]
	\arrow["{c \; \mapsto \Hom_{C}(-, c)}"', from=3-1, to=3-5]
	\arrow["{P \mapsto P(1)}"', from=3-5, to=1-3]
\end{tikzcd}\]

Here, the bottom arrow is the Yoneda embedding, sending each object of $C$ to the corresponding representable presheaf. The right arrow takes a presheaf to its global elements. The left arrow is the $\introF$ which is part of the structure of an introspective theory.

In general, we will write $\Box$ for a roundtrip around this diagram, starting from any of its three nodes.

Thus, we will write $\Box$ for the $T$-indexed lexfunctor from $T$ to itself given by $t \mapsto \Hom_C(1, \introF(t))$.

We will ALSO write $\Box$ for the $T$-indexed lexfunctor from $C$ to itself given by $c \mapsto \introF(\Hom_C(1, c))$.

And we will ALSO write $\Box$ for the $T$-indexed lexfunctor from $\Psh{C}$ to $\Psh{C}$, which sends the presheaf $P$ to the presheaf represented by $\introF(P(1))$.

When we want to clarify precisely the domain we are operating on, we may write $\Box_T$, $\Box_C$, or $\Box_{\Psh{C}}$, as appropriate.

As the Yoneda embedding is naturally thought of as the inclusion of a full sub-lexcategory, identifying $C$ with the corresponding representable presheaves within $\Psh{C}$, we may also think of $\Box_{\Psh{C}}$ as a $T$-indexed lexfunctor from $\Psh{C}$ to $C$. That is, as the composition of merely the top two arrows above.

The above was all discussed for $T$, $C$, and $\Psh{C}$ considered as $T$-indexed lexcategories, but this all (and the rest of this chapter as well) descends to corresponding structure on their global aspects as well. Keep in mind, in the global aspect context, $\introF$ is the same as $\introS$, so wherever in the above we discussed $\introF$, a corresponding statement holds as well for $\introS$, when considering just the global aspect.

\bigskip
(Incidentally, the reason we restricted attention here to locally $T$-small presheaves, rather than arbitrary presheaves, is so that the map $P \mapsto P(1)$ can indeed be taken as always landing back within $T$ and not within $T$-indexed sets more generally.

Similarly, the reason we restricted attention to locally introspective theories (i.e., the case where $C$ is locally $T$-small) and not to pre-introspective theories more generally is so that the Yoneda embedding $c \mapsto \Hom_C(-, c)$ does indeed land within the locally $T$-small presheaves, rather than arbitrary presheaves.)

The above all extends just as well to locally introspective finite product theories, but of course in that context all the lexfunctors are merely finite product preserving functors. \TODOinline{Word this better}

\subsection{Box preservation}
Note that, having set up these various notions of $\Box$, we find that $\Box$ and each of the maps in the diagram \quote{commutes} in the appropriate sense; that is, they can be seen as preserving each other.

For example, $\introF$ preserves $\Box$, in that both $\introF(\Box(-))$ and $\Box(\introF(-))$ yield the same $T$-indexed functor from the self-indexing of $T$ to $C$. This is readily seen by unwinding their definitions: These are both $\introF(\Hom_C(1, \introF(-)))$.

We also have that taking $\Hom_C(1, -)$ preserves $\Box$ in the same way. $\Hom_C(1, \Box(-)) = \Box(\Hom_C(1, -)) = \Hom_C(1, \introF(\Hom_C(1, -)))$. More generally, consider the map $G$ which assigns to every locally $T$-small presheaf $P$ upon $C$ its object of global elements $P(1)$. Then $G$ preserves $\Box$ in the same way: $G(\Box P) = \Box(G(P)) = \Hom_C(1, \introF(P(1)))$, where we make sense of $G(\Box P)$ by identifying $\Box P$ within $c$ with the presheaf it represents.

Given object $c$ of $C$, and locally $T$-small presheaf $P$ on $C$, we will write $c \implies P$ to indicate the exponential presheaf $P^c$. That is, the presheaf $P(- \times c)$. We may also write $c \implies d$ where $d$ is an object of $C$ as well, to mean $c \implies P$ for the presheaf $P = \Hom_C(-, d)$ represented by $d$. Thus, $c \implies d$ is the presheaf $\Hom_C(- \times c, d)$.

Note that for any locally $T$-small presheaf $P$ on $C$ and object $c$ of $C$, we have that $P(c)$ can be identified with the presheaf $c \implies P$ evaluated at $1$, and thus $\introF(P(c))$ can be identified with $\Box(c \implies P)$. In particular, by considering the case when $P$ is represented by object $d$, we find that $\Box(c \implies d)$ is naturally identifiable with $\introF(\Hom_C(c, d))$.

\subsection{Modal logic and axiom 4}
The choice of this $\Box$ notation for these purposes is meant to convey an analogy with the $\Box$ operator of modal logic, and in particular, with the provability operator of provability logic. We will explore this more in later remarks.

The key point here is that the rules of the $\Box$ operator in a Kripke normal modal logic are essentially the rules of a lex endofunctor on a lexcategory, and any of our $\Box$ operators is certainly lex as a composite of lex functors.

Furthermore, each of our $\Box$ operators comes with a natural transformation from $\Box$ to $\Box \Box$ corresponding to the so-called 4 axiom $\Box A \vdash \Box \Box A$.

For the $\Box$ operator on $T$ this is clear, as the natural transformation $\introN$ from identity to $\Box$ encodes the even stronger property $t \vdash \Box t$. The 4 axiom is the special case where $t$ here is itself of the form $\Box A$.

\[\begin{tikzcd}
	&& {T/} \\
	\\
	C &&&& {\Psh{C}}
	\arrow["\introF"', from=1-3, to=3-1]
	\arrow["{P \mapsto P(1)}"', from=3-5, to=1-3]
	\arrow[""{name=0, anchor=center, inner sep=0}, "{c \mapsto \Hom_C(-, c)}"', from=3-1, to=3-5]
	\arrow["{\introN : \id_T \to \Box_T}"{description}, shorten >=7pt, Rightarrow, from=1-3, to=0]
\end{tikzcd}\]

We do not have such a strong natural transformation from identity to $\Box$ as acting on the other corners of the triangle ($C$ or $\Psh{C}$). However, by taking the natural transformation from $t$ to $\Box_T t$, whiskering it on both sides along the trips from any other corner of the triangle into and out of $T$, and then applying the commutativity of $\Box$ with each leg of the triangle, we get a natural transformation from $\Box$ to $\Box \Box$ at each other corner of the triangle as well.

(The general principle here is that, given morphisms $f$ and $g$ between the same pair of objects in opposite directions, composing with $f$ on one side and $g$ on the other turns $(gf)^n$ into $(fg)^{n + 1}$, and thus whiskering in this way turns a natural transformation $: (gf)^n \to (gf)^m$ into a natural transformation $: (fg)^{n + 1} \to (fg)^{m + 1}$)

% https://q.uiver.app/?q=WzAsOCxbMSwwLCJcXFBzaHtDfSJdLFsyLDAsIlQiXSxbMywxLCJDIl0sWzQsMSwiXFxQc2h7Q30iXSxbNSwwLCJUIl0sWzMsMF0sWzYsMCwiQyJdLFswLDAsIkMiXSxbMCwxXSxbMSwyXSxbMiwzXSxbMyw0XSxbMSw0LCJcXGlkX1QiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDZdLFsyLDYsIlxcQm94X0MiLDIseyJjdXJ2ZSI6NX1dLFs3LDBdLFs3LDYsIlxcQm94X0MiLDAseyJjdXJ2ZSI6LTV9XSxbNywyLCJcXEJveF9DIiwyXSxbMTIsMTAsIlxcaW50cm9OIiwyLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwLCJ0YXJnZXQiOjIwfX1dXQ==
\[\begin{tikzcd}
	C & {\Psh{C}} & T & {} && T & C \\
	&&& C & {\Psh{C}}
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-3, to=2-4]
	\arrow[""{name=0, anchor=center, inner sep=0}, from=2-4, to=2-5]
	\arrow[from=2-5, to=1-6]
	\arrow[""{name=1, anchor=center, inner sep=0}, "{\id_T}", Rightarrow, no head, from=1-3, to=1-6]
	\arrow[from=1-6, to=1-7]
	\arrow["{\Box_C}"', curve={height=30pt}, from=2-4, to=1-7]
	\arrow[from=1-1, to=1-2]
	\arrow["{\Box_C}", curve={height=-30pt}, from=1-1, to=1-7]
	\arrow["{\Box_C}"', from=1-1, to=2-4]
	\arrow["\introN"', shorten <=4pt, shorten >=4pt, Rightarrow, from=1, to=0]
\end{tikzcd}\]

% https://q.uiver.app/?q=WzAsNyxbMCwwLCJcXFBzaHtDfSJdLFsxLDAsIlQiXSxbMiwxLCJDIl0sWzMsMSwiXFxQc2h7Q30iXSxbNCwwLCJUIl0sWzIsMF0sWzUsMCwiQyJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFsxLDQsIlxcaWRfVCIsMCx7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsNl0sWzMsNiwiXFxCb3hfe1xcUHNoe0N9fSIsMl0sWzAsMywiXFxCb3hfe1xcUHNoe0N9fSIsMix7ImN1cnZlIjo1fV0sWzAsNiwiXFxCb3hfe1xcUHNoe0N9fSIsMCx7ImN1cnZlIjotNX1dLFsxMSw5LCJcXGludHJvTiIsMix7InNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH19XV0=
\[\begin{tikzcd}
	{\Psh{C}} & T & {} && T & C \\
	&& C & {\Psh{C}}
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center, inner sep=0}, from=2-3, to=2-4]
	\arrow[from=2-4, to=1-5]
	\arrow[""{name=1, anchor=center, inner sep=0}, "{\id_T}", Rightarrow, no head, from=1-2, to=1-5]
	\arrow[from=1-5, to=1-6]
	\arrow["{\Box_{\Psh{C}}}"', from=2-4, to=1-6]
	\arrow["{\Box_{\Psh{C}}}"', curve={height=30pt}, from=1-1, to=2-4]
	\arrow["{\Box_{\Psh{C}}}", curve={height=-30pt}, from=1-1, to=1-6]
	\arrow["\introN"', shorten <=4pt, shorten >=4pt, Rightarrow, from=1, to=0]
\end{tikzcd}\]

(In the above two diagrams, all parallel paths commute except where an explicit natural transformation is noted, and all unmarked edges are the corresponding of the three edges along our triangle. In the diagram illustrating axiom 4 for $\Box_{\Psh{C}}$, we note that we can think of the codomain of $\Box_{\Psh{C}}$ as either $\Psh{C}$ or more narrowly its full subcategory $C$.)

Thus, our $\Box$ follows all the rules of the modal logic K4, in each of these contexts. Later, we shall see that the general logic followed by $\Box_C$ in a locally introspective theory is conversely no stronger than K4, while in an introspective theory, it is the modal logic GL. Indeed, in the very next chapter we will see how in an introspective theory we get the last ingredient for the modal logic GL, \Loeb/'s theorem.

\TODOinline{Citation to Boolos and other modal logic references at some point}

\TODOinline{Add commentary on how our box is actually a bifunctor instead of a single functor, as we do not presume cartesian closure. Add commentary on the case where we have cartesian closure, including how this reduces to a single box functor (either for the introspective theory or geminal category case), and including the relationship with double negation/Booleanness when Lob's theorem is introduced}

\subsection{Unorganized}
\subsubsection{Cartesian closure and \Loeb/'s theorem}
\begin{theorem}
Suppose $\langle T, C \rangle$ is a locally introspective simple theory (i.e., locally introspective finite product theory). Furthermore, suppose we have an object $0$ of $T$ such that all exponentials $0^t$ exist in $T$ (as in when $T$ is cartesian closed), and furthermore, there is a morphism in $T$ of type $\Box ((\Box 0) \implies 0) \vdash \Box 0$ (a \Loeb/ morphism). Let us refer to $0^X$ as $\neg X$. We then get a morphism in $T$ of type $1 \vdash \neg \neg \Box 0$; equivalently, a morphism of type $\neg \Box 0 \vdash 0$.
\end{theorem}
\begin{proof}
In $T$, we have $(\neg \Box 0) \times (\Box 0) \vdash 0$. There is also a general principle that if $T$ contains a morphism $X \times Y \vdash Z$, then $T$ also contains a morphism $X \vdash \Box (Y \implies Z)$ (by using $\introS$ to get $\Box X \vdash \Box(Y \implies Z)$, and then using $\introN$ to get $X \vdash \Box X$ and composing these).

Applying that general principle to this particular morphism, we find in $T$ a morphism $\neg \Box 0 \vdash \Box (\Box 0) \implies 0$. The right-hand side here combines with our \Loeb/ morphism; the result of this composition is $\neg \Box 0 \vdash \Box 0$. And from here we quickly get $\neg \Box 0 \vdash 0$, aka, $1 \vdash \neg \neg \Box 0$.
\end{proof}

The above shows the undesirability of using exponentiation in a cartesian closed $T$ to model ordinary implication, when using introspective theories to model ordinary provability logic, as this would imply a certain degree of incompatibility with Boolean logic. Specifically, in a Boolean context, when $0$ is actual falsehood so that $\neg \neg$ is supposed to be identity, the above would give us the rule $1 \vdash \Box 0$, asserting provable falsehood.

The appropriate way to model provability logic complete with an implication operator is not to take $T$ to be cartesian closed, but rather, to take only $C$ to be an indexed cartesian closed category. Note that even if $T$ happens to be cartesian closed as well, we will in general not have that $\introF$ must preserve exponentials; that is, exponentials computed via $T$'s cartesian closed structure may well differ from exponentials computed via $C$'s cartesian closed structure (especially \TODOinline{Only?} if $C$ has objects not in the range of $\introF$). It is the latter which are most relevant for ordinary provability logic. Thus, although $T$ being cartesian closed will give us $\introS(\neg_T \Box 0_T) \vdash_C \introS(0_T)$, it will not give us $\neg_C \introS(\Box 0_T) \vdash_C \introS(0_T)$. We will see this explicitly in model \TODO and model \TODO.

\subsubsection{Cartesian closed categories and locally introspective theories}
\begin{theorem}
We observe here that a locally introspective simple (i.e., finite product) theory in which $\introF$ is essentially surjective on objects is the same as a cartesian closed theory along with a finite product preserving $\Box$ and natural transformation $\introN : \id \to \Box$.
\end{theorem}
\begin{proof}
\TODO.
\end{proof}
Similarly, some analogue of the above for locally introspective finite limit theories? \TODO

\begin{TODOblock}
Similarly, some analogue of both of the above for geminal categories? The simplest observation is that, from any cartesian closed category C' with endo-fp-functor Box s.t. we have a natural transformation from Box to $\Box^2$ s.t. the two induced paths from Box to $\Box^3$ are equal, we can construct an introspective finite product theory T such that the objects of $T$ are finite products of objects of the form $\Hom_C(A, B)$ for objects $A$ and $B$ in $C(1)$, while the objects of $C$ at every aspect are the objects of $C'$. And of course $\introS(\Hom_C(A, B)) = \Box(B^A)$, while $\introN$ corresponds to our Box to $\Box^2$ operator. Maybe this is simpler put in terms of the observation as to what a geminal (simple/fp theory) cartesian closed category on given objects is.
\end{TODOblock}
\fileend