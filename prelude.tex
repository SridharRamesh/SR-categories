% The document class really belongs in the prelude, but Overleaf gets a little weird about that not being in the main document.

% Just some made up sizing for now. Can tinker with this later.
\usepackage[
  a4paper,
  margin=1in,
  headsep=5pt, % separation between header rule and text
]{geometry}

% Copied from Reid
\usepackage{amssymb,amsmath, amsthm}
\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography

% Put in by me, Sridhar
\usepackage{color}          % Color definitions (used for `blue`, `red`)
\usepackage{newpxtext}      % Use a nice text font
\usepackage{enumitem}       % Bulleted lists
  \setenumerate{parsep=10pt} % Futz with the exact value later
\usepackage{comment}        % Multiline comments
\raggedbottom               % No more underfull vbox errors
\usepackage{quiver}         % Commutative diagrams
\usepackage{indentfirst}    % Indent first paragraph in a section
\usepackage{csquotes}       % Quotation marks without needing `` and ''
\usepackage[style=authoryear]{biblatex}
\bibliography{references}   % Uses the file `references.bib` for bibliography information.
\usepackage{etoolbox}       % Generic LaTeX tools, including nice conditionals. Maybe unnecessary.

\renewcommand\qedsymbol{$\blacksquare$} % Change QED symbol to black square so it is not confused with the modal box

% The following are packages that might need to be loaded before hyperref
\usepackage{imakeidx}       % Indexing
  \makeindex[intoc]         % Include index in table of contents
  
% And now, hyperref!
\usepackage[colorlinks=true, linkcolor=blue]
  {hyperref}                % Hyper-linked references (note that certain packages need to be loaded before this instead of after this, such as indexing)
  
% And now... Packages that might need to be loaded after hyperref.
\usepackage[conf={restate}]
  {proof-at-the-end}        % Allows for moving proofs of theorems to later in the document, with auto-linking, restating, etc
\usepackage[capitalize, nameinlink]
  {cleveref}                % References named by type and number
\newcommand*{\parensref}[1]{\hyperref[{#1}]{\nameref*{#1} (\cref*{#1})}}              % References named by explicit name and parenthesized type and number

% It's not ideal that I have to manually keep track of when to use \cref vs. when to use \nameref or \parensref.
% The following solution is based on https://tex.stackexchange.com/a/66096/231784.
\newcommand{\magicref}[1]{%
  \if\vcenter\getrefbykeydefault{#1}{name}{}\vcenter
    \cref{#1}%
  \else
    \nameref{#1}%
  \fi
}
\newcommand{\magicparensref}[1]{%
  \if\vcenter\getrefbykeydefault{#1}{name}{}\vcenter
    \cref{#1}%
  \else
    \parensref{#1}%
  \fi
}


% For subfiles, in a toggle-able way
\newif\ifsubfiles

\newcommand{\filestart}{
    \ifsubfiles
    \documentclass[./main.tex]{subfiles}
    \begin{document}
    \fi
}

\newcommand{\fileend}{
    \ifsubfiles
    \end{document}
    \fi
}
\newcommand{\fileinclude}[1]{
    \ifsubfiles
    \newpage \subfile{#1}
    \else
    \include{#1}
    \fi
}