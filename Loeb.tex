\section{\Loeb's theorem}

\subsection{The basics of double indexing}
\begin{TODOblock}
The following is all preliminary scribblings, to be written up properly and moved to the Preliminaries later.
\end{TODOblock}

Suppose $T$ is some category and $C$ is some category indexed over $T$. What does it mean to speak of a $T$-indexed $C$-indexed structure? For example, a $T$-indexed $C$-indexed set. That is, a $T$-indexed $C$-indexed presheaf $P$.

What this means is that, for every object $t$ in $T$ and every $t$-defined object $c$ in $C$, we have some corresponding set of $P$ (the $t$-defined $c$-defined elements of $P$), and we also have a coherent system of pullback maps between these: Along any map $f : s \to t$ in $T$, we can pull back a $t$-defined $c$-defined element of $P$ to an $s$-defined $c$-defined element of $P$ (where the latter $c$ is implicitly the pullback along $f$ of the former $c$). And for any fixed $t$, given a $t$-defined map $g : d \to c$ in $C$, we can pull back a $t$-defined $c$-defined element of $P$ along this to a $t$-defined $d$-defined element of $P$. Both of these systems of pullbacks are functorial, and they also interact with each other \quote{commutatively} in the sense that pulling back along a map $g$ in $C$ and then pulling back along a map $f$ in $T$ is the same as pulling back along the map $f$ in $T$ and then pulling back along the map $g$ in $C$ (where, again, the latter, $g$ is implicitly the pullback along $f$ of the former $g$).

This all amounts to saying that $P$ is in fact indexed over the Grothendieck construction corresponding to $C$.

What about maps between such doubly-indexed sets? Well, this is the same as the notion we get again by thinking of these as in fact singly-indexed over the Grothendieck construction. A natural transformation in that context.

Now that we understand doubly-indexed sets and maps between them, we can also understand doubly-indexed structures in general. Including doubly-indexed strict categories, and everything about doubly-indexed categorical structures works in basically the same fashion.

That all being said, we won't really need any of that just yet. All we need is the concept of doubly-indexed sets. Even maps between these aren't really going to concern us, just yet.

\subsection{The basics of \Loeb's theorem}
Let $\langle T, C, F \rangle = \langle T, C, S, N \rangle$ be a pre-introspective theory. Consider now a $T$-indexed presheaf $P$ on $C$ which is $T$-small, in the sense that for any $t$-defined object $c$ of $C$, the value of $P$ at object $c$ is given by some $t$-defined object of $T/-$. In other words, the corresponding discrete fibration to $P$ has $T$-small fibers.

\TODOinline{Perhaps it suffices for T to be a category, C to be a T-indexed category with a designated (not necessarily terminal) object $*$, S to be a (not necessarily lex) functor from T to the global aspect of C, and N a natural transformation from t to $\Hom_C(*, S(t))$, so long as the needed things are T-small.} Let $T$, $C$, $S$, and $N$ be as whatever.

Consider now a $T$-indexed presheaf $P$ on $C$ which is $T$-small or whatever (\TODO). Suppose this comes also with a relation on it, which is to say, another presheaf $R$ on $C$ and maps $R_l, R_r : R \to P$ (meaning we get components for $R_l$ and $R_r$ at every object of $C$).

Presume also given some globally defined object $Y$ in $T$ and maps $u: P(S(Y)) \to Y$ and $d : Y \to P(S(Y))$ such that the identity on $P(S(Y))$ is related to $d \circ u$, in the sense that there is some map $\delta : P(S(Y)) \to R(S(Y))$ such that $R_{l, S(Y)} \circ \delta$ is the identity on $P(S(Y))$ while $R_{r, S(Y)} \circ \delta$ is $d \circ u$.

Suppose now given any generalized element $y$ of $Y$. Then, we can take the value $d(y)$ within $P(S(Y))$ and pull it back via the presheaf action of $P$ along the value $N_Y(y)$ within $\Hom_C(1, S(Y))$, to get a value inside $P(1)$. Thus, discharging our assumption of $y$, we have produced a morphism in $T$ from $Y$ to $P(1)$. Call this morphism $W$.

Suppose now given any generalized element $f$ of $P(S(P(1)))$.

By pulling $f :P(S(P(1)))$ back along $S(W) : \Hom_C(S(Y), S(P(1)))$, we get an element of $P(S(Y))$. By applying $u$ to this, we have an element of $Y$. And applying $W$ to this, we end up with an element of $P(1)$. Thus, discharging our assumption of $f$, we have produced a morphism in $T$ from $P(S(P(1)))$ to $P(1)$.

This final morphism represents \Loeb's theorem. For sake of a name, let's call it $L$ for now.

\subsection{The fixed point/relation point property}
Recall that $f$ is a generalized element of $P(S(P(1)))$ and $L(f)$ is a similarly generalized element of $P(1)$. We will show that $L(f)$ is related to pulling $f$ back along the map from $1$ to $S(P(1))$ given by applying $N_{P(1)}$ to $L(f)$.

Setting $y = u(S(W)^* f) : Y$, recall that $L(f)$ is $W(y) : P(1)$. Which is $d(y) = d(u(S(W)^* f))$ pulled back along $N_Y(y) : \Hom_C(1, S(Y))$; that is, $L(f) = W(y) = N_Y(y)^* d(u(S(W)^* f))$. By the naturality of our maps $R_l$ and $R_r$, the relationship between $S(W)^*f$ and $d(u(S(W)^*f))$ pulls back to a relationship between $N_Y(y)^* S(W)^*f = (S(W) \circ N_Y(y))^* f$ and $N_Y(y)^* d(u(S(W)^*f)) = L(f)$.

Finally, note that $N_Y(y) : \Hom_C(1, S(Y))$ composed with $S(W) : \Hom_C(S(Y), S(P(1)))$ is $N_{P(1)}(W(y))$ (by the naturality of $N$), which is to say, $N_{P(1)}(L(f))$. So $(S(W) \circ N_Y(y))^* f = N_{P(1)}(L(f))$, which completes the proof.

\begin{TODOblock}
Be more explicit above about what we mean by the relationship holding, in the sense of maps through $R$.
\end{TODOblock}

\begin{TODOblock}
We don't seem to use the lexness of S anywhere here. Is that correct, for the theorem phrased this way?
\end{TODOblock}

Note that $R$ here can be any kind of relation at all. When $R$ is specifically an equivalence relation, this is a kind of fixed point property. We will only be looking at such $R$ for now in this document, though it is worth thinking about more general $R$ in future work.

\begin{corollary}\label{RetractInT}
If $T$, $C$, $S$, $N$, and $P$ are given as above such that there is an object $Y$ in $T$ with $P(S(Y))$ being a retract of $Y$, then there is a map $L : P(S(P(1))) \to P(1)$ in $T$ satisfying the appropriate fixed point property.
\end{corollary}
\begin{proof}
Apply the above with the relation $R$ being equality; that is, with $R_l, R_r$ as identity.
\end{proof}

\begin{corollary}\label{RetractInC}
If $T$, $C$, $S$, $N$, and $P$ are given as above such that there is an object $X$ in $C$ with $S(P(X))$ being a retract of $X$, then there is a map $L : P(S(P(1))) \to P(1)$ in $T$ satisfying the appropriate fixed point property.
\end{corollary}
\begin{proof}
If $S(P(X))$ is a retract of $X$ in $C$, then by applying the contravariant functor $P$, we find that $P(S(P(X)))$ is a retract of $P(X)$ in $T$. Thus, taking $Y = P(X)$, we can apply \cref{RetractInT}.
\end{proof}

One application of these corollaries is to the untyped lambda calculus. It is well-known that the untyped lambda calculus is modelled by a cartesian closed category $T$ with an object $Y$ such that $Y^Y$ is a retract of $Y$. More generally, let us consider any cartesian closed category $T$ with objects $Y$ and $A$ such that $A^Y$ is a retract of $Y$. For such a $T$, let $C$ be the $T$-indexed category defined by the simple self-indexing, with $S$ and $N$ being the canonical isomorphisms of the appropriate type, and let $P$ be the presheaf $\Hom_C(-, A)$, which amounts to $A^{-}$. As we have presumed $A^Y$ to be a retract of $Y$, we can apply our above corollary, and find ourselves with a fixed point combinator from $P(S(P(1))) \iso A^A$ to $P(1) \iso A$. In the particular case where $A = Y$ so we model the untyped lambda calculus in the ordinary way, the fixed point combinator we obtain is essentially the familiar \quote{Y combinator} (no pun intended on the Y).

In the context of an introspective theory, we shall be able to get rid of the presumption of the retraction altogether, to get an unconditional version of \Loeb's theorem. Or rather, we shall be able to show that a suitable retraction always exists; indeed, a fortiori, a suitable isomorphism $Y \iso P(S(Y))$ always exists.

\subsection{Bootstrapping}
We will now show how to bootstrap away this assumption, in the context of an introspective theory:

Suppose we wish to apply our \Loeb's theorem taking $P$ to be the presheaf which assigns to every object $c$ of $C$, the underlying set\footnote{When we speak of \quote{the underlying set of objects} of $C/c$, we must have in mind some particular representation for $\Ob(C)$, but that is ok. An introspective theory is such that some representation exists, and any one we pick will suffice.} of objects of $C/c$ (i.e., those morphisms in $C$ with codomain $c$), with pullback as action on morphisms.

With one caveat! This presheaf isn't quite a presheaf, as it is valued not in sets but in setoids. Pullback isn't well-defined, it is only well-defined up to isomorphism. We must be careful about this. But we can deal with this suitably enough.

But supposing we take care of that, we shall impose upon this the relationship given by those same isomorphisms. That is, we take $R(c)$ to be the isomorphisms of $C/c$, with $R_r$ and $R_l$ as the domain and codomain maps.

Indeed, armed with the idea of this relationship, it becomes easy to deal with the problem from two paragraphs ago: We can always replace a 2-functorial presheaf $P'$ and isomorphism-respecting relationship $R'$ upon it, by a strictly functorial presheaf $P$, using the definition that $P(x)$ consists of an object $y$, a morphism from $x$ to $y$, and an element of $P(y)$, with the pullback action of $P$ simply being composition upon its morphism component. We then impose upon this presheaf $P$ the relationship $R$ under which two elements of $P$ are related by any relationship in $R'$ between the corresponding elements-up-to-isomorphism of $P'$. (When $R'$ itself is simply the isomorphism relationship, then $R$ is also simply the appropriate isomorphism relationship). \TODOinline{Write this out in a detailed way.}

We will then find a particular $Y$ in $T$ which acts as a retract-up-to-isomorphism in the necessary way to allow us to apply our \Loeb's theorem to this $P$ and $R$. Specifically, this $Y$ will be $P(S(\Mor(C)))$, the object of slices in $C$ above $\Mor(C)$. Any such slice above $\Mor(C)$ injects into $\Mor(C)$ [this is an injection, i.e. monic, as the slices above any particular object can be defined as an equalizer subobject of $\Mor(C)$, and equalizer inclusions are always monic]. Applying $S$ gives us an injection in $C$ from $S(Y)$ to $S(\Mor(C))$ [$S$ preserves monicity as it is a lexfunctor]. Push forward (i.e., composition) and pullback along this injection will be our maps from $P(S(Y))$ to and from $P(S(\Mor(C))) = Y$. The fact that this is a retraction-up-to-isomorphism is the fact that pushing forward and then pulling back along any monic map results in a slice isomorphic to the one started with. \TODOinline{Write out details}

The fixed point property we derive then tells us that, for any slice $Q$ above $S(\Ob(C))$ in $C$, there is some object $c$ of $C$ which is isomorphic to $Q$ pulled back along $N_{\Ob(C)}(c) : \Hom_C(1, S(\Ob(C)))$.

In particular, let $Q$ be the slice corresponding to some arbitrary presheaf $Q'$ on $C$. Then this tells us there is some object $c$ of $C$ which is isomorphic to $Q'(S(c))$. As an isomorphism is automatically a retract, this provides the precondition to run our categorical \Loeb's theorem on the presheaf $Q'$ itself (using \cref{RetractInC}).

Thus, in the context of an introspective theory, we can run the categorical \Loeb's theorem on ALL presheaves, unconditionally.

\subsection{Continuing}

\begin{TODOblock}
Discuss uniqueness of the fixed point for presheaves on the core of $C$ (i.e., fixed points of isovariantly functors), and the simultaneous initial algebra and terminal coalgebra properties for fixed points of covariant functors.
\end{TODOblock}