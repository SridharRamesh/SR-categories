\filestart

\section{\Loeb/'s theorem}

\subsection{Convenient terminology}
\begin{TODOblock}
Some note about how we will also make use in diagrams in this chapter liberally of the identification of $P(c)$ with $\Hom(c, P)$, when $P$ is a presheaf. If one likes, this can be seen as invoking the Yoneda lemma to draw diagrams in $\Psh{C}$ (although invoking the Yoneda lemma is actually a bit overkill for the mere fact that we can draw diagrams of presheaf elements and presheaf actions in this way, which is simply working within the appropriate collage, aka cocomma category).

We're a bit glib in all our writing when we swap between thinking of $x$ as an element in $X$, vs a map from $1$ to $X$, or similarly in swapping between a presheaf $\Omega^X$ and values in $\Omega(X)$ and morphisms from $X$ to $\Omega$, etc. Perhaps we should introduce some explicit notation for these kinds of conversions, to make everything perfectly clear.

Can move these notes to the Preliminaries.
\end{TODOblock}

\subsection{Lawvere's fixed point theorem}
Let us refresh the reader on Lawvere's fixed point theorem \autocite{lawvere1969diagonal}, which captures the general structure of many diagonalization arguments and their relationship to cartesian closed structure. We shall first review a proof of Lawvere's fixed point theorem close in spirit to Lawvere's framing of his result.

Then we will note a slight generalization for which essentially the same argument applies. Then in the next section we will turn this generalization into a result in the context of general pre-introspective theories. Then we will specialize further down to introspective theories, and observe a wonderful \quote{bootstrapping} phenomenon which arises there, which shall ultimately provide us with a form of \Loeb/'s theorem in that context, which is our main result.

(Although not important for our main narrative, we note in passing that another interesting generalization of \magicref{LawveresFixedPointTheorem} was recently remarked upon in \autocite{roberts2021substructural}. We will not need that particular result, but we remark upon its relation to our formulation of \magicref{LawveresFixedPointTheorem} in our Appendix at \magicref{MagmoidalFixedPointTheorem}.)

\openNamed{theorem}{Lawvere's Fixed Point Theorem}\label{LawveresFixedPointTheorem}
Let $T$ be an arbitrary category. Let $X$ be an object of $T$ and let $\Omega$ be any $T$-indexed set. Suppose also given some map $\App' : X \to \Omega^X$ (equivalent to the data of a map $\App : X \times X \to \Omega$).

Let $\point$ be any object of $T$. By a \quote{point} of a $T$-indexed set, we shall mean an element of its aspect at $\point$ (equivalent to the data of a map into it from $\point$).\footnote{Lawvere takes $\point$ to always be a terminal object, and for our goals that will ultimately suffice as well. But we shall see in the argument and the post-argument discussion that there is no need for such a restriction, so we do not impose it here.}

Suppose $\App'$ has the surjectivity-like property that, for every map $F : X \to \Omega$, there is a point $f$ of $X$, such that for every point $x$ of $X$, we have that $\App'(f)(x) = F(x)$ (in slight but straightforward notational abuse). That is to say, $\App(f, x) = F(x)$.

Then for any map $g : \Omega \to \Omega$, there exists a point $\omega$ of $\Omega$ such that $\omega = g(\omega)$. That is to say, there is a fixed point of $g$.
\closeNamed{theorem}
\begin{proof}
Let $F : X \to \Omega$ be the following composition:

% https://q.uiver.app/?q=WzAsNCxbMCwwLCJYIl0sWzIsMCwiWCBcXHRpbWVzIFgiXSxbMywwLCJcXE9tZWdhIl0sWzQsMCwiXFxPbWVnYSJdLFswLDEsIlxcbGFuZ2xlIFxcaWRfWCwgXFxpZF9YIFxccmFuZ2xlIl0sWzEsMiwiXFxBcHAiXSxbMiwzLCJnIl1d
\[\begin{tikzcd}
	X && {X \times X} & \Omega & \Omega
	\arrow["{\langle \id_X, \id_X \rangle}", from=1-1, to=1-3]
	\arrow["\App", from=1-3, to=1-4]
	\arrow["g", from=1-4, to=1-5]
\end{tikzcd}\]

That is, for any generalized element $x$ of $X$, we have that $F(x) = g(\App(x, x))$.

We know there exists a point $f$ of $X$ which corresponds with $F$ in the manner of our surjectivity-like supposition on $\App'$. Now consider the instance of this surjectivity-like supposition where $x = f$. This tells us that $\App(f, f) = F(f)$. But $F(f) = g(\App(f, f))$.

Thus, taking $\omega = \App(f, f)$, we have that $\omega = g(\omega)$ as desired.
\end{proof}

\TODOinline{Remarks on not requiring $T$ be to cartesian closed or $\Omega$ to be \repsmall/. Remarks on still taking $X$ to be \repsmall/. Remarks on letting $\point$ not be $1$.}

\TODOinline{Remarks on Cantor's theorem, Liar's paradox, and Y combinator as examples of Lawvere's fixed point theorem. Cantor's theorem is a contrapositive statement using surjection. Liar's paradox is a contrapositive statement using a retraction/isomorphism. Y combinator is a positive statement using a retraction, and also involves passing to a slice category. Y combinator is the best set up for what we do in the next section. Note that the reason we presume in Cantor's theorem that Omega has no fixed points is because of another instance of Lawvere's fixed point theorem, via Liar's paradox!}

In a similar vein, we put forward the following generalization:

\openNamed{theorem}{Self-Related Point Theorem}\label{SelfRelatedPointTheorem}
Let $T$ be an arbitrary category. Let $\point$ and $X$ be objects of $T$ and let $\Omega$ be any $T$-indexed set. Suppose also given some map $\App' : X \to \Omega^X$ (equivalent to the data of a map $\App : X \times X \to \Omega$).

As before, we shall use \quote{point of} as shorthand for \quote{element of the $\point$-aspect of}.

Suppose also given a binary relation $R$ on the points of $\Omega$. (We do not presume $R$ to be symmetric or transitive or any such thing.). And suppose $\App$ has the surjectivity-like property that, for every morphism $F : X \to \Omega$, there is a point $f$ of $X$, such that for every point $x$ of $X$, we have $R(\App(f, x), F(x))$.

Then there exists a point $\omega$ of $\Omega$ such that $R(\omega, \omega)$. That is to say, there is a self-related point of $R$.
\closeNamed{theorem}
\begin{proof}
Let $F : X \to \Omega$ be the following composition:

% https://q.uiver.app/?q=WzAsNCxbMCwwLCJYIl0sWzIsMCwiWCBcXHRpbWVzIFgiXSxbMywwLCJcXE9tZWdhIl0sWzQsMF0sWzAsMSwiXFxsYW5nbGUgXFxpZF9YLCBcXGlkX1ggXFxyYW5nbGUiXSxbMSwyLCJcXEFwcCJdXQ==
\[\begin{tikzcd}
	X && {X \times X} & \Omega & {}
	\arrow["{\langle \id_X, \id_X \rangle}", from=1-1, to=1-3]
	\arrow["\App", from=1-3, to=1-4]
\end{tikzcd}\]

That is, for any generalized element $x$ of $X$, we have that $F(x) = \App(x, x)$.

We know there exists a point $f$ of $X$ in accordance with our surjectivity-like supposition on $\App'$. Now consider the instance of the surjectivity-like supposition where $x = f$. This tells us that $R(\App(f, f), F(f))$. But $F(f) = \App(f, f)$.

Thus, we have found a point of $\Omega$ which is related to itself by $R$, as desired.
\end{proof}

It may not be obvious that this generalizes \magicref{LawveresFixedPointTheorem}. The following shows how this is so:

\openNamed{corollary}{Relatedly-Fixed Point Theorem}\label{RelatedlyFixedPointTheorem}
Consider the same setup as of \magicref{SelfRelatedPointTheorem}, and furthermore, suppose given $g : \Omega \to \Omega$.

Then there exists a point $\omega$ of $\Omega$ such that $R(\omega, g(\omega))$. We might describe this as \quote{$\omega$ is an $R$-fixed point of $g$}.
\closeNamed{corollary}
\begin{proof}
Consider the binary relation $R_g$ on points of $\Omega$ given by $R_g(\omega_1, \omega_2) = R(\omega_1, g(\omega_2))$.

We have been given the supposition that, for every morphism $F : X \to \Omega$, there is a point $f$ of $X$, such that for every point $x$ of $X$, we have $R(\App(f, x), F(x))$.

As this holds for arbitrary $F : X \to \Omega$, this also holds when an arbitrary $F$ is replaced by $g \circ F : X \to \Omega$. That is to say, for every $F : X \to \Omega$, there is a point $f$ of $X$, such that for every point $x$ of $X$, we have $R(\App(f, x), (g \circ F)(x))$, which is to say, $R_g(\App(f, x), F(x))$.

But this is precisely the surjectivity supposition we need in order to invoke \magicref{SelfRelatedPointTheorem} with $R_g$ in place of $R$. Doing so, we obtain a point $\omega$ of $\Omega$ such that $R_g(\omega, \omega)$, which is to say $R(\omega, g(\omega))$, as desired.
\end{proof}

Now we can see that \magicref{LawveresFixedPointTheorem} is of course the instance of \magicref{RelatedlyFixedPointTheorem} where the relation $R$ is taken to be equality. But \magicref{RelatedlyFixedPointTheorem} is strictly more general in allowing the use of an arbitrary relation. We shall find this added flexibility valuable in the next section.

(As for the relation between \magicref{RelatedlyFixedPointTheorem} and \magicref{SelfRelatedPointTheorem}, each is an instance of the other. We above obtained \magicref{RelatedlyFixedPointTheorem} as a corollary of \magicref{SelfRelatedPointTheorem}, while conversely, \magicref{SelfRelatedPointTheorem} is the special case of \magicref{RelatedlyFixedPointTheorem} where $g$ is taken to be $\id_{\Omega}$.)

\subsection{Presheaf diagonalization for pre-introspective theories}
\openNamed{theorem}{Pre-introspective Diagonalization}\label{RevampedPreintroLawvere}
Let $\langle T, C, \introS, \introN, 1 \rangle$ be a pre-introspective unary theory. As a reminder to the reader, this means, let $T$ be a category, let $C$ be a $T$-indexed category, let $\introS$ be a functor from $T$ to the global aspect of $C$, let $1$ be an object in the global aspect of $C$ (not necessarily a terminal object), and let $\introN$ be a natural transformation from $t$ in $T$ to $\Hom_C(1, \introS(t))$.

(In particular, any pre-introspective finite product theory carries all this structure, which covers all the applications we will be interested in, but we wish for a moment to make it clear that the following construction does not rely on such extra structure, just as we noted that \magicref{LawveresFixedPointTheorem} did not require exponential or product structure.)

Furthermore, let $\point$ be an object of $T$. As ever, we use \quote{point of} as shorthand for \quote{element of the $\point$-aspect of}.

(Again, our ultimate interest will only be in the case where $\point$ is taken as a terminal object.)

Consider now a $T$-indexed presheaf $P$ on $C$, aka a $(T, C)$-indexed set. We will write in the following $P(c)$ for globally defined objects $c$ of $C$ to mean the $T$-indexed set $t \mapsto P(t, c)$. In particular, when we write $P(1)$, we mean the $T$-indexed set $t \mapsto P(t, 1)$, rather than the global aspect of $P$.

Suppose also given some object $X$ in $T$ and map $\alpha : X \to P(\introS(X))$.

Now suppose given some $T$-\repsmall/ object $\Omega$ with a map $\quotient : \Omega \to P(1)$ such that $\quotient$ is surjective on the $X \times X$ aspect. Furthermore, let us suppose we have some $g$ in the global aspect of $P(\introS(\Omega))$. (Note that $\introS(\Omega)$ is well-defined because $\Omega$ is $T$-\repsmall/).

\TODOinline{Ordinarily, we would take $\Omega = P(1)$ and $\quotient$ as identity. But when we do our slice construction, we take $P$ to be the self-indexing construed as a set-valued presheaf, the sets of ISOMORPHISM CLASSES of the slice categories. While $\Omega$ will be the non-quotiented object $Mor(C)$.}

Now, let us make a surjectivity-like assumption on $\alpha$. Specifically, let us suppose that for every global element $p$ of $P(\introS(X))$, there is a point $x$ of $X$ such that $\alpha(x) = p$ (more precisely, by $p$ in this equation, we mean its reinterpretation from a global element into a point).

Then we obtain a point $\omega$ of $\Omega$, such that $\quotient(\omega) = \pullAlong{\introN_{\Omega}(\omega)} g$.
\closeNamed{theorem}
\begin{proof}
We shall show how this is an instance of \magicref{SelfRelatedPointTheorem}.

We now define $\App : X \times X \to \Omega$ like so: Consider the two projection maps $\pi_1, \pi_2 : X \times X \to X$, as two $(X \times X)$-defined elements of $X$. We thus obtain also $(X \times X)$-defined elements $\alpha(\pi_1)$ of $P(\introS(X))$ and $\introN_{X}(\pi_2)$ of $\Hom_C(1, \introS(X))$. Combining these via the presheaf action of $P$, we get $\pullAlong{( \introN_{X}(\pi_2) )} ( \alpha(\pi_1) )$ as an $(X \times X)$-defined element of $P(1)$. By the surjectivity presumption on $\quotient$, we find a preimage of this $(X \times X)$-defined element of $P(1)$ under $\quotient$. We take this to be our $\App : X \times X \to \Omega$. \TODOinline{Reword this}

We must now establish an appropriate surjectivity supposition on $\App$ for invoking \magicref{SelfRelatedPointTheorem}. 

Let an arbitrary $F : X \to \Omega$ be given. We then have that $\introS(F)$ is a global element of $\Hom_C(\introS(X), \introS(\Omega))$. We can pull $g$ (a global element of $P(\introS(\Omega))$) back along this to obtain a global element $\pullAlong{\introS(F)} g$ of $P(\introS(X))$. By the surjectivity-like assumption on $\alpha$ we made, we now have a corresponding point $f$ in $X$, such that $\alpha(f) = \pullAlong{\introS(F)} g$ (the right side here being reinterpreted from a global element into a point of $P(\introS(X))$).

This means that for every point $x$ of $X$, we get that $\pullAlong{\introN_{X}(x)} \alpha(f) = \pullAlong{\introN_{X}(x)} \pullAlong{\introS(F)} g$.

Note that by the definition of $\App$, we have that $\quotient(\App(f, x)) = \pullAlong{( \introN_{X}(x) )} \alpha(f)$.

Note that by \magicref{SWithN}, we have that $\introS(F) \circ_C \introN_{X}(x) = \introN_{\Omega}(F(x))$. Thus, by the functoriality of $P$, we have that $\pullAlong{\introN_{X}(x)} \pullAlong{\introS(F)} g =  \pullAlong{\introN_{\Omega}(F(x))} g$.

Combining these last three paragraphs, we have that $\quotient(\App(f, x)) =  \pullAlong{\introN_{\Omega}(F(x))} g$.

If we define $E_g(\omega_1, \omega_2)$ as $\quotient(\omega_1) = \pullAlong{\introN_{\Omega}(\omega_2)} g$ accordingly, we have now established the surjectivity supposition required in order to invoke \magicref{SelfRelatedPointTheorem} with $R = E_g$. From this invocation, we get a point of $\Omega$ which is related by $E_g$ to itself, which is just what we desired, ending the proof.

\TODOinline{Add diagrams?}
\end{proof}
\begin{corollary}\label{PreIntrospDiagSpecialization}
Although the above argument allowed for some greater generality in its stated presumptions, every instance we will be interested in is where $\langle T, C, \introS, \introN \rangle$ is given by a pre-introspective finite product theory, with the globally defined object $1$ of $C$ being its terminal object.

In many cases we are interested in (though not all!), we furthermore take $P(1)$ to be $T$-\repsmall/ and take $\Omega$ to be $P(1)$, with $\quotient$ as the identity. We then automatically have that the component of $\quotient$ at ${X \times X}$ is surjective as required (keeping in mind that $X \times X$ is indeed an object of $T$, when $T$ has finite products).
\end{corollary}

This process of turning $g: P(\introS(P(1)))$ into $\omega: P(1)$ will ultimately represent \Loeb/'s theorem. In our box symbolism, this process turns $g : P(\Box P)$ into $\omega : P(1)$, and when we apply $\introS$ to such a map, we get a map from $\Box((\Box P) \implies P)$ to $\Box P$. But this construction also captures diagonalization and associated fixed point arguments in general, in the modalized context of a pre-introspective theory with finite products. Let us observe the fixed point properties of this construction in such generality for now, then we will specialize to specifically introspective theories and investigate further.

\subsection{Corollaries}

\begin{observation}
Observe that we can recover the special case of \magicref{LawveresFixedPointTheorem} from \magicref{RevampedPreintroLawvere}.
\end{observation}
\begin{proof}
First, we handle the special case of \magicref{LawveresFixedPointTheorem} where $T$ has finite products and $\Omega$ is $T$-\repsmall/.

This is the special case of \magicref{RevampedPreintroLawvere} where we furthermore take the pre-introspective finite product theory $\langle T, C \rangle$ to be the trivial one noted at \TODOinline{Cite earlier construction}, where $C$ is the simple self-indexing $T//-$, and $\introF$ is the identity.

$\Omega$ is taken as an arbitrary object of $T$, and $P$ is then taken to be the $(T, C)$-indexed set represented by $\Omega$; that is, such that $P(t, c) = \Hom_T(t \times c, \Omega)$. Note that $P(\introS(t))$ for objects $t$ of $T$ is therefore the $T$-indexed set $\Omega^t$. In particular, $P(1)$ is thus isomorphic to $\Omega$; as in \magicref{PreIntrospDiagSpecialization} we can take $\quotient$ to be this isomorphism, and this will then automatically be surjective on its $X \times X$ component.

We take $\alpha : X \to P(\introS(X)) = \Omega^X$ to be given by the map $\App' : X \to \Omega^X$ presumed in \magicref{LawveresFixedPointTheorem}. The surjectivity presumption from \magicref{LawveresFixedPointTheorem} then becomes the surjectivity presumption of \magicref{RevampedPreintroLawvere}. 

And to give a $g$ in the global aspect of $P(\introS(\Omega)) = \Omega^\Omega$ is precisely the data presumed by the name $g$ in \magicref{LawveresFixedPointTheorem}.

This matches all the presumptions of \magicref{RevampedPreintroLawvere} up with corresponding presumptions from \magicref{LawveresFixedPointTheorem}, and the conclusion we then obtain from \magicref{RevampedPreintroLawvere} is readily seen to be the same as the conclusion from \magicref{LawveresFixedPointTheorem}.

The above shows how to obtain \magicref{LawveresFixedPointTheorem} as an instance of \magicref{RevampedPreintroLawvere} when $T$ is a finite product category and $\Omega$ is $T$-\repsmall/. We then obtain \magicref{LawveresFixedPointTheorem} in full (that is, for arbitrary categories $T$ and $T$-indexed sets $\Omega$) from this special case, by first replacing $T$ with $\Psh{T}$, as noted at \TODOinline{Cite our previous discussion}.
\end{proof}

\begin{theorem}
Suppose given a pre-introspective finite product theory $\langle T, C, \introS, \introN \rangle$ and a locally $T$-\repsmall/ presheaf $P$ \TODOinline{Standardize this terminology across this section, the modal logic section, and the preliminaries} on $C$.

If there is any object $X$ of $T$ with an isomorphism from $X$ to $P(\introS(X))$, then for every globally defined $g : \Box P \to P$, we obtain an $\omega : 1 \to P$, such that $g \circ \omega' = \omega$, where the globally defined $\omega' : 1 \to \Box P$ is given by $\introN_{P(1)}(\omega)$. \TODOinline{Clarify this notation}

We get the same result also if there is any object $Y$ in the global aspect of $C$ along with a globally defined isomorphism from $Y$ to $\introS(P(Y))$.
\end{theorem}
\begin{proof}
Any isomorphism $\alpha : X \to P(\introS(X))$ (or even just a split epic) will automatically satisfy the surjectivitity-like assumption for us to invoke \magicref{PreIntrospDiagSpecialization}, with $\Omega$ as $P(1)$ and $\quotient$ as identity. Thus once we are given such an isomorphism, we can invoke \magicref{PreIntrospDiagSpecialization}, and its result is the fixed point result noted in this theorem.

For the final remark, note that fixed points up to isomorphism of any endofunctor $F \circ G$ are in correspondence with fixed points up to isomorphism of the endofunctor $G \circ F$, with the functors $G$ and $F$ carrying out the two directions of the correspondence. (For that matter, we can also observe that values $X$ such that $F(G(X))$ is a retract of $X$ are in correspondence with values $Y$ such that $G(F(Y))$ is a retract of $Y$.). In this particular case, this means that fixed points up to isomorphism of the endofunctor $P(\introS(-))$ on $T$ are in correspondence with fixed points up to isomorphism of the endofunctor $\introS(P(-))$ on the global aspect of $C$.
\end{proof}

\subsection{Bootstrapping to \Loeb/'s theorem for introspective theories}
\TODOinline{Rewrite this to the new structure from above}
We will now show how to bootstrap away this precondition, in the context of an introspective theory:

Essentially, our plan is to apply RetractInT \TODO taking $P$ to be the presheaf which assigns to every object $c$ of $C$, the underlying set\footnote{When we speak of \quote{the underlying set of objects} of $C/c$, we must have in mind some particular representation for $\Ob(C)$, but that is ok. An introspective theory is such that some representation exists, and any one we pick will suffice. Put another way, we can take ourselves to be working with an inner-strict introspective theory, as every introspective theory can be equipped as such.} of objects of $C/c$ (i.e., those morphisms in $C$ with codomain $c$), with pullback as action on morphisms.

There is one caveat! This presheaf isn't quite a presheaf, as it is naturally valued not in sets but in setoids\footnote{If we assumed $T$ to be an effective regular category, we could quotient any setoid internal to $T$ into a corresponding plain object of $T$, but we do not wish to require this assumption. Instead, we will take advantage of our ability to use relation $R$ in arbitrary $T$ to achieve the same end.}. Pullback isn't well-defined, it is only well-defined up to isomorphism, and if we pick chosen pullbacks in some arbitrary fashion, there is no guarantee that pullback will be strictly functorial. In other words, this is a 2-functor rather than a functor. We must be careful about this.

But supposing we take care of that, we will at any rate naturally want to impose upon this $P$ the relation given by those same isomorphisms. That is, we take $R(c)$ to be the isomorphisms of $C/c$, with its two projections to $\Ob(C/c)$ being the domain and codomain maps.

Indeed, armed with the idea of this relationship, it becomes easy to deal with the problem from two paragraphs ago: We can always replace a 2-functorial presheaf $P'$ and isomorphism-respecting relation $R'$ upon it, by a strictly functorial presheaf $P$, using the definition that $P(x)$ consists of an object $y$, a morphism $m$ from $x$ to $y$, and an element $e$ of $P(y)$, with the transport-back action of $P$ simply being composition upon its morphism component. This is automatically strictly functorial. There a clear inclusion $i$ of $P'(x)$ into $P(x)$ via sending each element $e$ of $P'(x)$ to the element $\langle x, \id_x, e \rangle$ of $P(x)$, and a corresponding retraction $f$ from $P(x)$ onto $P'(x)$, taking an element $\langle y, m : x \to y, e \rangle$ of $P'(y)$ to the transport $m^* e$ or $P(m) e$ of $e$ back along $m$ via the action of $P$.

We then impose upon this presheaf $P$ the relation $R$ under which two elements $(p, q)$ of $P$ are related by any relationship in $R'$ between elements $(p', q')$ of $P'$, along with an isomorphism between $p'$ and $f(p)$ and an isomorphism between $q'$ and $f(q)$. (When $R'$ itself is simply the isomorphism relationship, then $R$ also amounts to relating all and only those things which are isomorphic). It is straightforward to verify that this relation $R$ has a groupoid structure itself, and that its projection maps to $P$ are indeed natural transformations between presheaves. \TODOinline{Write this out in a detailed way.}

We now need a particular $Y$ in $T$ which acts as a retract-up-to-isomorphism in the necessary way to allow us to apply our \Loeb/'s theorem to this $P$ and $R$. Specifically, we can take this $Y$ to be $P'(\introS(\Mor(C)))$, the object of slices in $C$ above $\Mor(C)$. [Note that we are only able to consider such a $Y$ because $\Mor(C)$ is $T$-small, the defining property of an introspective theory]. The collection of such slices above $\Mor(C)$ injects into $\Mor(C)$ [this is an injection, i.e. monic, as the slices above any particular object can be defined as an equalizer subobject of $\Mor(C)$, and equalizer inclusions are always monic]. Applying $\introS$ gives us an injection in $C$ from $\introS(Y)$ to $\introS(\Mor(C))$ [$\introS$ preserves monicity as it is a lexfunctor]. Composition and pullback along this injection will be our maps in the two directions between $P'(\introS(Y))$ and $P'(\introS(\Mor(C))) = Y$. The fact that this is a retraction-up-to-isomorphism is the fact that composing and then pulling back along any monic map results in a slice isomorphic to the one started with. We have written this retraction-up-to-isomorphism now using $P'$ rather than our strictly functorial $P$, but as $P'$ is equivalent to $P$ in the sense of isomorphic-up-to-isomorphism, we get the same result for $P$ as well. \TODOinline{Write out details.}

The fixed point property we derive then tells us:

\begin{theorem}\label{ObjectToSetFixedPoint}
For any slice $Q$ above $\introS(\Ob(C))$ in $C$, there is some object $c$ of $C$ which is isomorphic to $Q$ pulled back along $\introN_{\Ob(C)}(c) : \Hom_C(1, \introS(\Ob(C)))$.
\end{theorem}

In particular, let $Q$ be $\introS$ applied to the slice above $\Ob(C)$ in $T$ corresponding to some arbitrary $T$-small presheaf $Q'$ on $C$. Then the above invocation of our \Loeb/'s theorem tells us there is some object $c$ of $C$ which is isomorphic to $\introS(Q'(c))$; what we might call a \quote{fixed point} of $Q'$ in abuse of language. As an isomorphism is automatically a retract, this in turn provides the precondition needed to run our categorical \Loeb/'s theorem on the presheaf $Q'$ itself (in the form of RetractinC \TODO).

Thus, in the context of an introspective theory, we can run the \Loeb/'s fixed point theorem on ALL presheaves, unconditionally. That is, we have proven the following:

\openNamed{corollary}{Introspective \Loeb/'s theorem}\label{LoebInIntrosp}
If $\langle T, C, \introS, \introN \rangle$ is an introspective theory, and $P$ is any $T$-small presheaf upon $C$, then there is a map $L : P(\introS(P(1))) \to P(1)$ in $T$ satisfying the fixed point property that for every generalized element $f$ of $P(\introS(P(1)))$, we have that $L(f)$ equals the result of transporting $f$ back via the action of $P$ along $\introN_{P(1)}(L(f))$.

Using our $\Box$ symbolism and the Yoneda lemma identification of elements of $P(c)$ with maps from $c$ to $P$, we can phrase this fixed point property of $L(f)$ as the following morphism of $\Box$-algebras within (the appropriate aspect of) $\Psh{C}$:

\[\begin{tikzcd}
	{\Box 1} && {\Box P} \\
	\\
	1 && P
	\arrow["f", from=1-3, to=3-3]
	\arrow["{!}"', from=1-1, to=3-1]
	\arrow["{\Box L(f)}", from=1-1, to=1-3]
	\arrow["{L(f)}"', from=3-1, to=3-3]
\end{tikzcd}\]

Thus, the $\Box$-algebra with carrier $1$ is weakly initial within $\Psh{C}$, in the sense that it has some morphism into every other $\Box$-algebra.
\closeNamed{corollary}

Although we have just proven that this property holds for all introspective theories automatically, it does not hold automatically for merely locally introspective theories. However, we shall see later on that there are some natural examples of locally introspective theories that happen to have this property as well, and we shall see in a second a number of corollaries of this property that work just as well for locally introspective theories as for introspective theories. Thus, let us make this useful definition:

\begin{definition}
A \defined{locally \Loeb/\ theory} is a locally introspective theory $T$ such that each of its slice locally introspective theories $T/t$ has the same properties of \magicref{LoebInIntrosp}, save for being locally introspective rather than fully introspective.
\end{definition}

\begin{conjecture}
Every locally \Loeb/\ theory can be embedded into an introspective theory.
\end{conjecture}

\begin{observation}
Although we above observed that in any introspective theory there is an object $Y$ such that the object of slices in $C$ above $\introS(Y)$ was merely a retract-up-to-isomorphism of $Y$, we can now reapply \magicref{LoebInIntrosp} to construct an object $Y'$ such that the object of slices in $C$ above $\introS(Y')$ is in fact isomorphic-up-to-isomorphism to $Y'$. \TODOinline{Word this better and verify the details. Actually, I think this isn't true when we don't have effective regularity. I should remove this observation, after verifying that.}
\end{observation}

\subsection{Uniqueness and initiality/terminality for fixed points}
Throughout this section, we work in the context of an introspective theory $\langle T, C \rangle$. \TODOinline{Figure out how much of this works for a locally \Loeb/\ theory, possibly tweaking the definition of a locally \Loeb/\ theory as needed}

\begin{theorem}\label{UniqueFixedPoints}
The fixed points produced by \nameref{LoebInIntrosp} are unique, in the sense that for any $t$-defined point $f$ of $P(\introS(P(1)))$ and any two $t$-defined points $a$ and $b$ of $P(1)$ satisfying the appropriate fixed point property (that is, each is equal to $f$ transported back along $\introN$ of itself), we have that $a = b$.
\end{theorem}
\begin{proof}
By passing to the appropriate slice introspective theory $T/t$, we can assume without loss of generality that all relevant values in the following are globally defined; i.e., without loss of generality, we can presume $t = 1$.

Consider the equalizer $E$ of $a$ and $b$. This is a subobject of $1$. If there were a map from $1$ to $E$, then $a$ and $b$ would be equal. In just the same way, taking this equalizer diagram's image under the lexfunctor $\introS$, we see that any value in $\Hom_C(1, \introS(E))$ would lead to $\introS(a)$ and $\introS(b)$ being equal, thus corresponding to equal maps from $1$ to $\introS(P(1))$ in $C$. Transporting $f$ back along these two would yield equal values, therefore. But transporting $f$ back along these two yields $a$ and $b$ respectively, so we would have that $a$ and $b$ are equal. This argument yields a morphism from $\Hom_C(1, \introS(E))$ to $E$ in $T$. Applying $\introS$ to this, we have a morphism in $C$, which lives in $Q(\introS(Q(1)))$, where $Q$ is the presheaf on $C$ represented by $\introS(E)$. Applying \parensref{LoebInIntrosp} to this, we get an element of $Q(1)$, which is to say, a global element of $\introS(E)$ in $C$. This makes $\introS(a)$ and $\introS(b)$ equal as global points of $\introS(P(1))$ in $C$. And by transporting $f$ back along these, we conclude as before that $a$ and $b$ are equal. \TODOinline{Word this all better}
\end{proof}

\begin{observation}
Note that this argument made essential use of the structure (notably, equalizers) available in an introspective theory, and thus does not apply in such full generality as GeneralDig \TODO does. For example, we saw in \parensref{YCombinator} that we get fixed points for arbitrary functions in the untyped lambda calculus, but as a cartesian closed category in general is not an introspective theory, we cannot conclude that fixed points of functions in the untyped lambda calculus are unique (and indeed, they will not be, as one such function is the identity function, whose fixed points are all values!).
\end{observation}

\TODOinline{Show that the equalizer from X to []X to X equalized against $\id_X$ is $1$}

\begin{observation}
Note that this means that the apparent dependence on which particular object $Y$ and retraction from $P(\introS(Y))$ into $Y$ is used in the diagonalization theorem doesn't actually matter, in this context. We get the same result no matter what.
\end{observation}

A similar argument to \magicref{UniqueFixedPoints} tells us that fixed points for endofunctors are unique, and even some initial algebra/terminal coalgebra properties for them:

\begin{theorem}\label{CoalgToAlgExist}
Suppose $Q$ is a $T$-small presheaf on the opposite category of $C$. (That is, a $T$-indexed covariant functor from $C$ to the self-indexing of $T$ whose category of elements is $T$-small). This induces a covariant endofunctor $Q(\introS(-))$ on $T$. Suppose $a : A \to Q(\introS(A))$ is a coalgebra for this functor within $T$ and $b : Q(\introS(B)) \to B$ is an algebra for this functor within $T$. Then there is some coalgebra-to-algebra morphism $g$ from $\introS(a)$ to $\introS(b)$ within $C$. That is, there is some $g : \introS(a) \to \introS(b)$ within $C$ such that $g = \introS(a) \circ \introS(Q(g)) \circ \introS(b)$.
\end{theorem}
\begin{proof}
Note that the action of $Q$ gives us a morphism from $\Hom_C(\introS(A), \introS(B)) \times Q(\introS(A))$ to $Q(\introS(B))$ within $T$. By pre- and post-composing this with $a$ and $b$, respectively, we get a morphism from $\Hom_C(\introS(A), \introS(B)) \times A$ to $B$ within $T$. By applying $\introS$ to this, we get a globally defined morphism within $C$ from $\introS(\Hom_C(\introS(A), \introS(B))) \times \introS(A)$ to $\introS(B)$. This morphism is of type $P(S(P(1)))$, where $P$ is the $T$-small presheaf upon $C$ defined by $P(-) = \Hom_C(- \times \introS(A), \introS(B))$.

Thus, we can apply our fixed point theorem \parensref{LoebInIntrosp} to this value. The result is a value $g$ in $P(1)$ (i.e., in $\Hom_C(\introS(A), \introS(B))$) which is equal to $\introS(a \circ Q(g) \circ b)$, as desired.

\TODOinline{Write diagrams to make this all clearer}
\end{proof}

\begin{theorem}\label{CoalgToAlgUnique}
The theorem \magicref{CoalgToAlgExist} can be strengthened to not only produce a coalgebra-to-algebra morphism, but also to conclude that such a coalgebra-to-algebra morphism is unique.
\end{theorem}
\begin{proof}
After applying \magicref{CoalgToAlgExist} with a suitable presheaf $Q$ to get existence, apply \magicref{UniqueFixedPoints} with that same presheaf to get uniqueness.
\end{proof}

\begin{theorem}
Given $Q$ as in \magicref{CoalgToAlgExist}, there exists a unique (up to isomorphism) fixed point of $Q(\introS(-))$, in the sense of a unique (up to isomorphism) object $A$ and isomorphism $a : A \to Q(\introS(A))$. This fixed point is both a terminal coalgebra and (its inverse is) an initial algebra.
\end{theorem}
\begin{proof}
We get the existence of an object $A$ and isomorphism $a : A \to Q(\introS(A))$ directly from \magicref{ObjectToSetFixedPoint}.

Furthermore, by \magicref{CoalgToAlgUnique}, any coalgebra has a unique map into any algebra, from which it follows that any inverse morphism of a coalgebra (or algebra) is in fact an initial algebra (or terminal coalgebra). Since initial (or terminal) objects are all isomorphic to each other, we immediately have the uniqueness up to isomorphism we seek.
\end{proof}

Essentially identical arguments work when dealing with presheaves on the opposite category of the core of $C$ (that is, its subcategory including only its isomorphisms):

\begin{theorem}\label{CoreCoalgToAlgExist}
Suppose $Q$ is a $T$-small presheaf on the opposite category of the core of $C$. This induces a covariant endofunctor $Q(\introS(-))$ on the core of $T$. Suppose $a : A \to Q(\introS(A))$ is a coalgebra for this functor within the core of $T$ and $b : Q(\introS(B)) \to B$ is an algebra for this functor within the core of $T$. Then there is some coalgebra-to-algebra isomorphism $g$ from $\introS(a)$ to $\introS(b)$ within $C$. That is, there is some $g : \introS(a) \to \introS(b)$ within $C$ such that $g = \introS(a) \circ \introS(Q(g)) \circ \introS(b)$.
\end{theorem}
\begin{proof}
Note that the action of $Q$ gives us a morphism from $\Iso_{C}(\introS(A), \introS(B)) \times Q(\introS(A))$ to $Q(\introS(B))$ within $T$. Actually, this satisfies a stronger property, of corresponding to a morphism from $\Iso_{C}(\introS(A), \introS(B))$ to $\Iso_T(Q(\introS(A)), Q(\introS(B)))$.

By pre- and post-composing this with $a$ and $b$, respectively, we get a morphism from $\Iso_C(\introS(A), \introS(B)) \times A$ to $B$ within $T$, that corresponds to a morphism from $\Iso_C(\introS(A), \introS(B))$ to $\Iso_T(A, B)$.

By applying $\introS$ to this, we get a globally defined morphism within $C$ from $\introS(\Iso_C($ $\introS(A), \introS(B))) \times \introS(A)$ to $\introS(B)$, that corresponds to a morphism from $\introS(\Iso_C(\introS(A), \introS(B)))$ to $\Iso_C(\introS(A), \introS(B))$.

This morphism is of type $P(S(P(1)))$, where $P$ is the $T$-small presheaf upon the core of $C$ defined by $P(c)$ amounting to $c$-defined isomorphisms from $\introS(A)$ to $\introS(B)$.

Thus, we can apply our fixed point theorem \parensref{LoebInIntrosp} to this value. The result is a value $g$ in $P(1)$ (i.e., in $\Iso_C(\introS(A), \introS(B))$) which is equal to $\introS(a \circ Q(g) \circ b)$, as desired.

\TODOinline{Write diagrams to make this all clearer}
\end{proof}

\begin{theorem}
The theorem \magicref{CoreCoalgToAlgExist} can be strengthened to not only produce a coalgebra-to-algebra isomorphism, but also to conclude that such a coalgebra-to-algebra isomorphism is unique.
\end{theorem}
\begin{proof}
After applying \magicref{CoreCoalgToAlgExist} with a suitable presheaf $Q$ to get existence, apply \magicref{UniqueFixedPoints} with that same presheaf to get uniqueness.
\end{proof}

\TODOinline{Thus, not only is there an essentially unique fixed point for isovariant functors from C to T, but furthermore, this unique fixed point is rigid}

It is worth noting that the proofs of \magicref{UniqueFixedPoints}, of \magicref{CoalgToAlgExist}, and of \magicref{CoreCoalgToAlgExist} can all be unified, seen as different instances of one general theorem. \TODOinline{Do this, and then having done so, the above cleans up a lot.}

\begin{TODOblock}
Discuss how we may conclude that our functorial fixed points are both initial algebras and terminal coalgebras. Note that Loeb's theorem itself is the initial algebra property for []1 |- 1.
\end{TODOblock}

\begin{TODOblock}
Discuss how we get \Loeb/'s theorem not just for globally defined objects of $C$, but for arbitrary objects of $C$, by working within the locally introspective theory $T/D$ for suitable base of definition $D$, or within $T/\Ob(C)$ generically in an introspective theory. And this transfers into $C$ itself (such that $C$ holds \Loeb/'s theorem to be true for arbitrary objects of $\introS(C) = C_1$) via $\introS$. Write up details for this, including making sure we have the right slice-introspective theory construction.
\end{TODOblock}

\begin{TODOblock}
Demonstrate that we do NOT get Loeb's theorem internal to a geminal category G for arbitrary presheaves P on |G'|, thus demonstrating the necessity of the presheaf existing within an introspective theory. The presheaf needs to be parametrized by a parameter from an object of an enclosing introspective theory. So P(S(X)) |- []P(S(X)) is available.
\end{TODOblock}

\begin{TODOblock}
Related work to our discussion of of uniqueness and initiality/terminality for fixed points within an introspective theory.

Discuss the relationship to models of guarded recursion, and the Birkedal et al paper on \quote{First steps in synthetic...}, where the initiality/terminality argument for contractive functors is presented. Basically, Birkedal's definition 7.2 and lemma 7.6 do the work for us in establishing initality/terminality, but we can use contractive internal categories, rather than locally contractive enriched categories. We could consider indexed categories too? Also, the establishment of the existence of fixed points from fixed points on the universe is done in "Intensional Type Theory with Guarded Recursive Types qua Fixed Points on Universes", and the uniqueness of fixed points following from Loeb's theorem is given there too. The uniqueness of the Loeb combinator is also given in "MULTIMODAL DEPENDENT TYPE THEORY" by Gratzer, Kavvos, Birkedal, et al. So essentially everything in this subsection is anticipated by those. Except that we can comment on the implications when the distinction between T and C is drawn, and when there is no cartesian closure presumption, and when we use non-representable presheaves, etc. Note that C doesn't correspond to the universe U, but rather to []U (or some other category into which []U has a lexfunctor; in a super-introspective theory, perhaps C is particularly close to just []U itself). Our T is like the U-small sets. The assumption we make that others do not is that []U is itself U-small. By dropping the cartesian closure assumption, we are also able to encompass the initial arithmetic universe as a model.

Roughly speaking, the difference between our theory and the theory such as in "Intensional Type Theory with Guarded Recursive Types qua Fixed Points on Universes" is all about cartesian closure and the smallness of []U. A super-introspective theory which happens to be locally cartesian closed (on both the levels of T and C, though the [] operator needn't preserve exponentials) corresponds to a model of guarded recursive types with universes where []U and [](sigma u, v : U. El(u) -> El(v)) are U-small. We do not bother making this correspondence formal, but leave it for future work. The dropping of cartesian closure from the presumptions allows us to encompass the initial arithmetic universe and its ilk as models, while adding the presumption of []U etc as U-small allows us to derive \Loeb/'s theorem from this instead of having to presume it by fiat. (More generally, it allows us to show how \Loeb/'s theorem applies not just to objects of C but also to non-representable presheaves on C in the form P(S(P(1))) |- P(1)).
\end{TODOblock}

\subsection{Scratch/old material}
Combining Lawvere's theorem and these last corollaries, we get the following:

\openNamed{observation}{Y Combinator}\label{YCombinator}
It is well-known that the equational theory of the untyped lambda calculus (in full generality not presuming the $\eta$-conversion rule, only $\alpha$- and $\beta$-conversion) is modelled by a cartesian closed category $T$ with an object $Y$ such that $Y^Y$ is a retract of $Y$. More generally, let us consider any cartesian closed category $T$ with objects $Y$ and $\Omega$ such that $\Omega^Y$ is a retract of $Y$.

As in Lawvere's Theorem, let $C$ be the $T$-indexed category defined by the simple self-indexing, with $\introS$ and $\introN$ being the canonical isomorphisms of the appropriate type, and let $P$ be the presheaf $\Hom_C(-, \Omega)$, which amounts to $\Omega^{-}$.

As we have presumed $\Omega^Y$ to be a retract of $Y$, we can apply either of our above corollaries (RetractinT and RetractInC amount to the same as each other in this case, as $T$ matches the global aspect of $C$), and find ourselves with a fixed point combinator from $P(\introS(P(1))) \iso \Omega^{\Omega}$ to $P(1) \iso \Omega$. 

In the particular case where $Y$ and $\Omega$ are the same object so we model the untyped lambda calculus in the ordinary way, the fixed point combinator we obtain is essentially the familiar \quote{Y combinator} (no pun intended on the $Y$). \qed
\closeNamed{observation}

In a sense, all we have shown so far are some very familiar results. Diagonalization is quite old hat. Its formalization in terms of cartesian closed structure to yield Lawvere's theorem, with Cantor's theorem and the Y combinator as special cases of this, is well known. Cf. Lawvere's and Yonofsky's existing papers on diagonal arguments, fixed point theorems, and cartesian closed categories. \TODOinline{Write whatever should be written here, make whatever citations. Point out the error in Yonofsky's discussion of Kleene's recursion theorem and how our more general formulation allows us to correct this.}

But the value of \magicref{PreIntrospDiagSpecialization} is that we have now formalized it at a particularly general level of abstraction, even more general than Lawvere's theorem, which will allow us to move beyond cartesian closed structure as such, into suitably modalized exponentials. Instead of only producing the traditional Y combinator, what we produce in general will be a suitably modalized Y combinator, as is necessary for the context we now turn to, of introspective theories.

In the context of an introspective theory, taking $P$ to be $T$-small in general\footnote{That is, presuming $P(c)$ is $T$-small for every generalized object $c$ of $C$; equivalently, that $P$ has a $T$-small category of elements.}, we shall be able to remove the precondition of the retraction from RetractInT and RetractInC, to get an unconditional version of \Loeb/'s theorem. Or rather, we shall be able to show that a suitable retraction always exists; indeed, a fortiori, a suitable isomorphism $Y \iso P(\introS(Y))$ always exists.

\fileend