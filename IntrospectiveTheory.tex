\filestart

\section{Introspective theories}

% Non-evil definition
\subsection{First definition (indexed style)}

\begin{definition} \label{DefnPreIntrospIndexed}
A \defined{pre-introspective theory} is a lexcategory $T$, a $T$-indexed lexcategory $C$, and a lexfunctor $\introF$ from the self-indexing of $T$ to $C$, like so:

\[\begin{tikzcd}
	{\op{T}} && {\LexCat}
	\arrow["{T/-}"{name=0}, from=1-1, to=1-3, shift left=2]
	\arrow["{C}"{name=1, swap}, from=1-1, to=1-3, shift right=2]
	\arrow[Rightarrow, "{\introF}"', from=0, to=1]
\end{tikzcd}\]
\end{definition}

We write out the triple $\langle T, C, \introF \rangle$ to refer to a pre-introspective theory when we wish to be fully explicit about its structure. But in typical abuse of language, we also often refer to it simply by the name of its underlying lexcategory $T$ or of the pair $\langle T, C \rangle$, when this would not cause confusion. We will frequently use the same name $\introF$ as though it applies to all introspective theories simultaneously, in the same way that notation like $+$ or $\times$ is overloaded as applying over all rings simultaneously.

\begin{definition} \label{DefnIntrospIndexed}
An \defined{introspective theory} is a pre-introspective theory $\langle T, C \rangle$ in which $C$ is \repsmall/.
\end{definition}

The concept of an introspective theory is the fundamental object of our interest and study in these notes. We shall show that this simple definition already suffices to exhibit and capture all the fundamental phenomena of \Goedel\ codes, diagonalization, the \Goedel\ incompleteness theorems, and \Loeb's theorem. And we shall show that all the traditional instances of \Goedel's incompleteness phenomena arise from special cases of this purely algebraic structure. We will also demonstrate functorial fixed point results for this structure, and show some interesting applications of these.

We shall also introduce some further generalizations of this concept, in order to be able to state results along the way in their fullest generality or point out connections to related work or interesting structures that are not quite introspective theories per se but are closely related. But throughout these notes, if at any time the abstractions seem daunting or distracting, remember that the concrete concept which matters most is the concept of an introspective theory as defined above.

The example-oriented reader may immediately demand an example of a pre-introspective theory, to orient themselves. I am not a particularly example-oriented thinker or writer, but let us at least note the simplest example (or class of examples) of a pre-introspective theory:

\begin{example} \label{TrivialPreIntrospIndexed}
Let $T$ be one's favorite lexcategory, any lexcategory of one's choice. Then a pre-introspective theory can be made from this where we take $\introF$ to be the identity (with $C$ as the self-indexing of $T$).
\end{example}

Alas, this simple example of a pre-introspective theory is almost never an introspective theory (that is to say, a lexcategory's self-indexing is almost never \repsmall/; indeed, the only case in which this happens is the trivial one where $T$ is the terminal category\footnote{This can be seen as a consequence of our categorical \Loeb's theorem established in the next chapter.}). We will give an archetypal example of an introspective theory soon enough, but let us first develop some further machinery on how pre-introspective theories may be presented.

\subsection{Second definition (non-indexed style)}

We shall now make an observation about an alternative but equivalent way to specify the data of a pre-introspective theory.

\begin{theorem}\label{SNCorrespondence}
Given a lexcategory $T$ and a $T$-indexed lexcategory $C$, specifying a pre-introspective theory $\langle T, C, \introF \rangle$ (i.e., specifying a $T$-indexed lexfunctor from the self-indexing $T/-$ to $C$) is equivalent to specifying a (non-indexed) lexfunctor $\introS$ from $T$ to the global aspect of $C$, along with specifying a natural transformation from $t$ in $T$ to $\Hom_C(1, \introS(t))$.
\end{theorem}

As preparation for the proof of \cref{SNCorrespondence}, we will need two lemmas. Both of these lemmas should be understood as obvious, folklore, etc, but we will write out proofs of them for self-containedness.

\begin{theoremEnd}[category=IntrospLemmas]{lemma}\label{Lemma1}
If $Y$ is a category with initial object $0$ and $X$ is a (2-)category, then to any functor $f : Y \to X$, we can associate a corresponding functor $f'$ from $Y$ to the slice category $f(0)/X$.

Furthermore, if $D$ and $C$ are parallel functors from $Y$ to $X$, then a natural transformation from $D$ to $C$ amounts to the same thing as a map $\introS$ from $D(0)$ to $C(0)$ along with a natural transformation from $D'$ to $\introS^{*} \circ C'$, where $\introS^{*} : C(0)/X \to D(0)/X$ is the functor between these slice categories given by composition with $\introS$.
\end{theoremEnd}
\begin{proof}
The first half of the lemma is thoroughly straightforward. $f : Y \to X$ induces a functor between the arrow category of $Y$ and the arrow category of $X$, and since $Y$ sits inside its arrow category as the slice category $0/Y$, this gives us a functor from $Y$ to the arrow category of $X$, which when followed by the domain projection back to $X$ is constantly $f(0)$. This is our $f'$.

The second half is also straightforward to mechanically verify when $X$ is a 1-category. This lemma should be understood as a triviality. But we will take some care to write out in detail an abstract demonstration that works just as well when $X$ is a 2-category (or indeed, when all categories involved are of whatever higher dimension), so that (in keeping with our linguistic convention) the functors involved are pseudofunctors, the natural transformations are pseudonatural transformations, etc, without having to get our hands dirty manually fussing about higher-dimensional coherence data.

See \hyperref[proof:prAtEnd\pratendcountercurrent]{full proof} on page~\pageref{proof:prAtEnd\pratendcountercurrent}.
\end{proof}
\begin{proofEnd}[no link to proof]
We pick up from where we left off previously in the proof of \cref{Lemma1}.

Throughout the remainder of this proof, all references to \quote{category}, \quote{functor}, etc, are in the sense of whatever dimension of higher-categories encapsulates both $Y$ and $X$.

Let $Z$ be the category obtained by augmenting $Y$ with a new object $0_Z$ and unique maps from $0_Z$ to each object of $Y$. We have an inclusion functor $i : Y \to Z$, and this inclusion is fully faithful, in the sense that the induced map $\Hom_Y(y_1, y_2) \to \Hom_Z(i(y_1), i(y_2))$ is an equivalence for all $y_1, y_2 \in \Ob(Y)$.

The unique maps from $0_Z$ to each object in the range of $i$ constitute a diagram of this form:

\[\begin{tikzcd}
	& 1 \\
	Y && Z
	\arrow["\unique", from=2-1, to=1-2]
	\arrow["{0_Z}", from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center}, "i"', from=2-1, to=2-3]
	\arrow[Rightarrow, from=1-2, to=0]
\end{tikzcd}\]

What's more, because of how $Z$ was constructed by freely augmenting $Y$ with a new object and co-cone from it to the inclusion of $Y$, this diagram satisfies the universal property that for any other similar diagram
\[\begin{tikzcd}
	& 1 \\
	Y && Z'
	\arrow["\unique", from=2-1, to=1-2]
	\arrow[from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center}, from=2-1, to=2-3]
	\arrow[Rightarrow, from=1-2, to=0]
\end{tikzcd}\]
there is a unique functor from $Z$ to $Z'$ commutatively relating the two diagrams. In jargon, this universal property is summarized by saying $Z$ (along with the data of $0_Z$ and $i$) is the co-comma of the unique functor from $Y$ to $1$ and the identity functor from $Y$ to $Y$.

Now, observe that $i$ has a left adjoint, the functor $q : Z \to Y$ such that $q \circ i$ is the identity on $Y$ and such that $q$ of the initiality co-cone for $0_Z$ in $Z$ is the initiality co-cone for $0$ in $Y$. That is, $q$ is the functor obtained by the co-comma property for $Z$ as applied to this diagram expressing the initiality co-cone of $0$ in $Y$:

\[\begin{tikzcd}
	& 1 \\
	Y && Y
	\arrow["\unique", from=2-1, to=1-2]
	\arrow["{0}", from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center}, "\id"', from=2-1, to=2-3]
	\arrow[Rightarrow, from=1-2, to=0]
\end{tikzcd}\]

It is straightforward to verify that this $q$ is indeed left adjoint to $i$, as any data in $Z$ is either from the fully faithful inclusion of $Y$ or from the initiality co-cone for $0_Z$, and $\Hom_Y(q(i(y_1)), y_2) \iso \Hom_Y(y_1, y_2) \iso \Hom_Z(i(y_1), i(y_2))$ naturally in $y_1, y_2$ from $Y$, and $\Hom_Y(q(0_Z), y) = \Hom_Y(0, y) \iso 1 \iso \Hom_Z(0_Z, i(y))$ naturally in $y$ from $Y$.

Now consider any two parallel functors $D, C : Y \to X$. Because $q \circ i$ is the identity on $Y$, we have that $\Nat(D, C) \iso \Nat(D \circ q \circ i, C)$, where $\Nat$ denotes the space of natural transformations between these functors. But because $q \dashv i$, we in turn have that $\Nat(D \circ q \circ i, C) \iso \Nat(D \circ q, C \circ q)$.

Finally, let us consider what a natural transformation between $D \circ q$ and $C \circ q$ amounts to. This is the same as a functor from $Z$ to the arrow category of $X$ whose domain and codomain projections to $X$ yield $D \circ q$ and $C \circ q$. But by the co-comma property of $Z$, this functor out of $Z$ corresponds to data of the following form:

\[\begin{tikzcd}
	& 1 \\
	Y && {\arrowcat{X}}
	\arrow["\unique", from=2-1, to=1-2]
	\arrow[from=1-2, to=2-3]
	\arrow[""{name=0, anchor=center}, from=2-1, to=2-3]
	\arrow[Rightarrow, from=1-2, to=0]
\end{tikzcd}\]

such that the rightmost arrow of this diagram corresponds to some arrow $\introS$ in $X$ whose domain is $(D \circ q)(0_Z) = D(0)$ and whose codomain is $(C \circ q)(0_Z) = C(0)$, and such that the bottom arrow of this diagram corresponds to a natural transformation from $D \circ q \circ i \iso D$ to $C \circ q \circ i \iso C$. The 2-cell in the above diagram then corresponds to the remaining data necessary for us to construe this natural transformation from $D$ to $C$ as simply the codomain projection of a natural transformation between $D'$ and $\introS^{*} \circ C'$, the functors from $Y$ to $D(0)/X$ as mentioned in the statement of this lemma.

\TODOinline{Phew! That made a mountain out of a molehill. But perhaps people sometimes appreciate such written-out detail.}
\end{proofEnd}

In order to state the next lemma, some terminology:

\begin{definition}
If $T$ is a lexcategory, then for each object of $t$, we can construct the free lexcategory extending $T$ with a global element of $t$. Call this $T[1 \to t]$. Also, for any $f : s \to t$ in $T$, we can get a map from $T[1 \to t]$ to $T[1 \to s]$ by sending the generic global element of $t$ in $T[1 \to t]$ to the result of applying $f$ to the generic global element of $s$ in $T[1 \to s]$. This action is clearly functorial. Thus, $T[1 \to -]$ comprises a $T$-indexed lexcategory-under-$T$. \TODOinline{Move this and \cref{Lemma2} to Preliminaries. It should be mentioned at the same time that we grant $T/-$ the name \quote{self-indexing} to begin with. And we should do the same for finite product categories and the simple self-indexing.}
\end{definition}

\begin{theoremEnd}[category=IntrospLemmas]{lemma}\label{Lemma2}
$T[1 \to -]$ is $T/-$, as a $T$-indexed lexcategory-under-$T$.
\end{theoremEnd}
\begin{proof}
This is a standard observation (see 1.10.15 of Bart Jacobs' \quote{Categorical logic and type theory}, although this claims it without proof), and also simple enough to show. See \hyperref[proof:prAtEnd\pratendcountercurrent]{full proof} on page~\pageref{proof:prAtEnd\pratendcountercurrent}.
\end{proof}
\begin{proofEnd}[no link to proof]
To start off, we construe $T/-$ as not merely a $T$-indexed lexcategory, but furthermore a $T$-indexed lexcategory-under-$T$ (equivalently, $T/1$) by appeal to the first half of \cref{Lemma1} as applied to $T/- : \op{T} \to \LexCat$. Note that, for any particular object $t$ of $T$, this identifies $T/1$ inside $T/t$ via pullback along the unique map from $t$ to $1$; thus, $T$ is identified as the subcategory of \quote{constant} data within $T/t$. We may explicitly refer to this inclusion lexfunctor as $i_t : T \to T/t$. (Beware that in general, $i_t$ is faithful but not full!)

Now, what we want to show that given any fixed diagram in $\LexCat$ of this form
\[\begin{tikzcd}
	& T \\
	{T/t} && V
	\arrow["{i_t}"', from=1-2, to=2-1]
	\arrow["f", from=1-2, to=2-3]
\end{tikzcd}\]
there is a correspondence between commutative triangles extending this diagram with a lexfunctor from $T/t$ to $V$, and elements of $\Hom_V(1, f(t))$.

Well, suppose given $m : 1 \to f(t)$ in $V$. Consider now how the action of $f$ on arrows induces a functor $f' : T/t \to V/f(t)$. Because $f$ preserves finite limits, and finite limits in a category determine the finite limits in its slice categories, this functor $f'$ also preserves finite limits. Furthermore, by pullback along $m$, we get a lexfunctor $m^* : V/f(t) \to V$. Thus, altogether, we get a lexfunctor $m^* \circ f' : T/t \to V$. What's more, the following diagram commutes:

\[\begin{tikzcd}
	& T \\
	{T/t} && V \\
	& {V/f(t)}
	\arrow["{i_t}"', from=1-2, to=2-1]
	\arrow["f", from=1-2, to=2-3]
	\arrow["{f'}"', from=2-1, to=3-2]
	\arrow["{m^*}"', from=3-2, to=2-3]
\end{tikzcd}\]

To see that this diagram commutes, observe that it can be decomposed like so:

\[\begin{tikzcd}
	& T \\
	{T/t} & V & V \\
	& {V/f(t)}
	\arrow["{i_t}"', from=1-2, to=2-1]
	\arrow["f", from=1-2, to=2-3]
	\arrow["{f'}"', from=2-1, to=3-2]
	\arrow["{m^*}"', from=3-2, to=2-3]
	\arrow["f"', from=1-2, to=2-2]
	\arrow["{i_{f(t)}}"', from=2-2, to=3-2]
\end{tikzcd}\]

Here, $i_{f(t)}$ is the inclusion lexfunctor from $V$ into $V/f(t)$ in the analogous way to $i_t : T \to T/t$. The left half of this diagram commutes because, $f$ being a lexfunctor, the operations \quote{Pull back along the map from $t$ to $1$ and then apply $f$ to the resulting slice} and \quote{Apply $f$ and then pull back along the map from $f(t)$ to $1$} are the same. The right half of this diagram commutes because $m^* \circ i_{f(t)}$ is identity, because this amounts to pulling back along two morphisms in a row, ultimately pulling back along a path from $1$ to $1$, and any morphism from $1$ to $1$ is the identity. \TODOinline{Phrase this better?}

Thus, every element of $\Hom_V(1, f(t))$ induces a corresponding commutative triangle of lexfunctors from $i_t : T \to T/t$ to $f : T \to V$.

Conversely, any such commutative triangle induces an element of $\Hom_V(1, f(t))$. To see this, we just need to see that there is some global element of $i_t(t)$ already in $T/t$.

Note that $i_t(t)$ is one of the projections from $t \times t$ to $t$. Furthermore, the terminal object in $T/t$ is the identity slice from $t$ to $t$. So the following commutative triangle serves as a global element of $i_t(t)$ within $T/t$:

\[\begin{tikzcd}
	t && {t \times t} \\
	& t
	\arrow["id"', from=1-1, to=2-2]
	\arrow["{i_t(t)}", from=1-3, to=2-2]
	\arrow["{\langle \id, \id \rangle}", from=1-1, to=1-3]
\end{tikzcd}\]

Let us use the name $g_t$ for this global element of $i_t(t)$ within $T/t$.

Now, we need to show that these two processes are inverse. \TODO

Finally, we must show that the re-indexings given by morphisms in $T$ via the definition of $T[1 \to -]$ correspond to the same reindexings as defined via $T/-$. \TODO
\end{proofEnd}

Now, we shall prove \cref{SNCorrespondence}.

\begin{proof}
Let $T$ be a lexcategory, and let $C$ be some $T$-indexed lexcategory. By \cref{Lemma1} (keeping in mind the contravariance of the functors defining indexed structures), a map from the self-indexing $T/-$ to $C$ as $T$-indexed lexcategories is the same as a lexfunctor $\introS$ from $T$ to the global aspect of $C$, along with a map from $T/-$ to $C$ as $T$-indexed (lexcategories under $T$). The map $\introS$ will be used to treat $C$ as a lexcategory under $T$.

Next we apply \cref{Lemma2}. The map from $T/-$ to $C$ as $T$-indexed (lexcategories under $T$) is the same as choosing, in a natural way over all $t$ in $T$, some $t$-defined value in $\Hom_C(1, \introS(t))$. That is, a natural transformation from $t$ to $\Hom_C(1, \introS(t))$.
\end{proof}

\begin{remark}\label{IntrospGeneralDoctrine}
It wasn't fundamentally important that we were dealing with lexcategories here. The use of \Cref{Lemma1} as applied to $\op{C}$ only required a terminal object in $C$. And for any algebraish notion extending categories-with-global-elements, there is some free construction $T[1 \to -]$. (Even the role terminality plays here is to some degree eliminable, though we have no interest for now in eliminating it). In particular, for categories-with-finite-products, there is also a simple independent account of the free structure $T[1 \to t]$, amounting to the full subcategory $T//t$ of $T/t$ on just those slices which are projections from some $t \times s$ to $t$ (the so-called \quote{simple self-indexing}). So we get the same result if we replace throughout \quote{lexcategory} and \quote{lexfunctor} by finite-product structure, and replace $T/-$ by this simple self-indexing. The same also holds for for any notion extending the notion of lexcategories which is automatically inherited by slice categories and preserved by pullback, or any notion extending the notion of finite-product-categories which is automatically inherited by these reduced slice categories and preserved by their pullbacks. For example, toposes or locally cartesian closed categories or cartesian closed categories or categories with finite products and finite coproducts over which they distribute or etc. Even infinitary notions could be used; categories with all limits of cardinality up to some regular cardinal, say.
\end{remark}

As a result of \cref{SNCorrespondence}, we can give an alternative definition equivalent to \cref{DefnPreIntrospIndexed}:

\begin{definition}\label{DefnPreIntrospSN}
A \defined{pre-introspective theory} is a lexcategory $T$, a $T$-indexed lexcategory $C$, a lexfunctor $\introS$ from $T$ to the global aspect of $C$, and a natural transformation $\introN$ from $t$ in $T$ to $\Hom_C(1, \introS(t))$.
\end{definition}

Much as before, we may write out $\langle T, C, \introS, \introN \rangle$ to be fully explicit, but in typical abuse of language, will refer to a pre-introspective theory by simply naming $T$ or the pair $\langle T, C\rangle$. We will frequently use the same names $\introS$ and $\introN$ as though they apply simultaneously to all such structures (in the same way that notation like $+$ and $\times$ is overloaded as applicable to separate rings simultaneously).

The definition of an introspective theory remains exactly as before (\cref{DefnIntrospIndexed}) regardless of how one thinks of pre-introspective theories, but for reminder's sake:

\begin{definition} \label{DefnIntrospSN}
An \defined{introspective theory} is a pre-introspective theory $\langle T, C \rangle$ in which $C$ is small.
\end{definition}

While it may sometimes be easier to prove theorems about (pre-)introspective theories by using \cref{DefnPreIntrospIndexed}, it will often be easier to show structures actually are (pre-)introspective theories by using \cref{DefnPreIntrospSN}. But this is not the only benefit of \cref{DefnPreIntrospSN}. The value of this new definition is that there is much less data around to explicitly fuss about. In particular, when we wish to turn this into a lex definition in section \TODO, we will find the coherence conditions much easier to manage. It will also be easier to define the appropriate notion of homomorphisms between (pre-)introspective theories by thinking about \cref{DefnPreIntrospSN}.

\Cref{DefnPreIntrospSN} also allows us to quickly appreciate the significance of introspective theories from a functorial semantics point of view. An introspective theory is precisely an essentially algebraic theory (this is the role of $T$) extending the theory of lexcategories (this is the role of $C$), such that every model of the theory is equipped with a designated homomorphism (this is the role of $\introN$) into an internal model of the same theory (this is the role of $\introS$).

\subsection{A concrete example}

\begin{construction}\label{SigmaModelSimple}
Let us now finally give the example-oriented reader an archetypal example of an introspective theory by which to orient themselves. (On the other hand, the reader who is perfectly happy to consider abstract definitions without needing to see a worked out example of a highly concrete flavor may skip this section at this introductory time if they find its details a distraction). The following construction will be discussed in more detail later at \cref{Sigma1Model}.
\end{construction}

Let us start with the first-order logical theory ZF-Finite: the theory ZF but with the axiom of infinity replaced by its negation\footnote{This theory happens to be equivalent to Peano Arithmetic in a suitable sense, but it will be more convenient for us to speak in terms of ZF-Finite so as not to fret about codings of a sort every modern mathematician readily takes for granted in a ZF-style context.}. The universe this theory describes is the hereditarily finite sets. Throughout this construction, whenever we speak of formulae, we mean formulae in the language of ZF-Finite, and whenever we speak of provability, we mean provable within ZF-Finite.

Certain formulae are $\Sigma_1$. These are the formulae which consist of an initial string of unbounded existential quantifiers (ranging over the entire universe), after which all other quantifiers are bounded (ranging only over the elements of some particular definable finite set).

Now let us define a category $T'$ whose objects are the $\Sigma_1$ formulae with one free variable. Such formulae amount to certain definable subsets of the universe.

Given two such objects $\phi(n)$ and $\psi(m)$, we take as morphisms between these any $\Sigma_1$ formula $F(n, m)$ which provably acts as the graph of a function between the corresponding subsets of the universe. That is, such that both $\forall n, m . F(n, m) \implies (\phi(n) \wedge \psi(m))$ and $\forall n . \phi(n) \implies \exists! m . F(n, m)$ are provable.

Two such morphisms $F(n, m)$ and $G(n, m)$ are considered equal just in case $\forall n, m . F(n, m) \biimplies G(n, m)$ is provable. 

Finally, morphisms compose in the obvious way; that is, the composition of $F(n, p)$ with $G(p, m)$ is given by $(G \circ F)(n, m) = \exists p (F(n, p) \wedge G(p, m))$.

We omit here the straightforward details of verifying that this structure $T'$ we have just described does indeed satisfy the rules to be a category. Indeed, it is furthermore a regular category (that is, it has finite limits and image factorization; it has finite products because of the definability of ordered pairs in ZF-Finite, and it furthermore has equalizers and image factorization using suitable instances of Separation in ZF-Finite). However, it is not an exact category (that is, not every equivalence relation in $T'$ admits a corresponding quotient). Let $T$ be its ex/reg completion.

(There is not in general any need for the categories involved in an introspective theory to be exact, or even regular. They need only have finite limits. However, for the particular construction we are outlining now, this ex/reg completion is the $T$ we need to look at.)

More explicitly, we can describe $T$ like so:

Its objects are the $\Sigma_1$ binary relations $\phi(n, m)$ which can be proven to be partial equivalence relations (i.e., symmetric and transitive), thus corresponding to certain subquotients of the universe.

Given any two such formulae $\phi(n_1, n_2)$ and $\psi(m_1, m_2)$, a morphism in $T$ from $\phi$ to $\psi$ is a $\Sigma_1$ formula $F(n, m)$ which provably corresponds to the graph of a function between the corresponding subquotients of the universe. That is, such that the universal closures of all the following are provable:

$F(n, m) \implies \phi(n, n) \wedge \psi(m, m)$

$\phi(n_1, n_2) \wedge \psi(m_1, m_2) \wedge F(n_1, m_1) \implies F(n_2, m_2)$

$\phi(n, n) \implies \exists m [F(n, m)]$

$F(n, m_1) \wedge F(n, m_2) \implies \psi(m_1, m_2)$.

Two such formulae $F(n, m)$ and $F'(n, m)$ are considered to be equal as morphisms from $\phi$ to $\psi$ if they are provably equivalent (that is, if both $\forall n, m . F(n, m) \implies F'(n, m)$ and $\forall n, m . F'(n, m) \implies F(n, m)$ are provable).

Given morphisms $F : \phi \to \psi$ and $G: \psi \to \chi$ of this sort, we again define their composition in the usual way of composing functions represented as graphs, as $(G \circ F)(n, m) = \exists p [F(n, p) \wedge G(p, m)]$.

This all describes the category $T$, which one can verify is indeed a category and moreso, an exact category.

Note that our construction of $T$ is such that the objects of $T$, the morphisms of $T$, the equality relation on morphisms of $T$, the composition structure of $T$, the finite limit structure of $T$, etc, are all definable within the language of ZF-Finite; indeed, all definable by $\Sigma_1$ formulae. (In particular, keep in mind that provability in ZF-Finite is itself a $\Sigma_1$ property). Thus, there is a lexcategory $D$ internal to $T$ which corresponds to this very same construction of $T$ we have just described. And we have a lexfunctor $\introS$ from $T$ to the global aspect of $D$ which sends each piece of the construction of $T$ to the corresponding piece of the construction of $D$. This is all straightforward.

As the last bit of introspective theory structure, we must build a natural transformation $\introN$ from the identity endofunctor on $T$ to the endofunctor $\Hom_D(1, \introS(-))$ on $T$. The core idea behind this $\introN$ is simple. Essentially, to every hereditarily finite set $x$, we can assign it a code $\code{x}$, which is an explicit term in the language of ZF-Finite denoting that set. The easy way to do this is to recursively assign to each set $\{a, b, c, \ldots\}$ the term describing a finite set whose members are explicitly enumerated by the terms assigned to $a, b, c, \ldots$. We thus send a set such as $\{\{\}, \{\{\}\}\}$ to the term in the language of ZF-Finite which might be called \quote{$\{\{\}, \{\{\}\}\}$} within quotation marks, and so on. \TODOinline{This is actually an initial algebra catamorphism, keep in mind.}

This gives us a function $\code{-}$ from hereditarily finite sets to terms in the language of ZF-Finite which describe hereditarily finite sets. This function $\code{-}$ is definable by a $\Sigma_1$ formula and thus gives a morphism in $T$. This serves as the component of $\introN$ at the object of $T$ describing ALL hereditarily finite sets. 

The other objects of $T$ are subquotients of that object (and similarly for the objects of $D$), and therefore the components of the natural transformation $\introN$ at these other objects can now be obtained uniquely so long as certain factorizations exist. That is to say, the component of $\introN$ at any object $\phi(n_1, n_2)$ of $T$ will also be given by the action of $\code{-}$, but for this to indeed work to map $t$ into $\Hom_D(1, \introS(t))$, we need to know that $\code{-}$ when acting on individuals which are related by the partial equivalence relation $\phi$ produces terms which provably describe individuals related by $\phi$.

This is where the $\Sigma_1$-ness of $\phi$ plays a vital role. For any $\Sigma_1$ property $\phi$, we can prove that, for all $x$, whenever $\phi$ holds of $x$, it furthermore provably holds of $x$ (in the sense that the particular term $\code{x}$, when substituted into the argument of the formula $\phi$, yields a sentence which is provable). \TODOinline{Do we need to go into more detail as to why this is true? It's a classical fact. One first establishes it for every $\Sigma_0$ property (we show that every atomic relation is truly and provably Boolean-valued and has this "Truth implies provability" property both for itself and its negation, and thus so do all combinations of atomic relations under propositional connectives (which reduces to Boolean combinations), and we also have the same closure under bounded quantification), and then shows that if $\phi(x, \ldots)$ has this \quote{Truth entails Provability} property, so does $\exists x. \phi(x, \ldots)$, given that any existential witness $x$ induces a term $\code{x}$ that serves as witness in a proof (that is, as the domain over which we are quantifying (the natural numbers or hereditarily finite sets or whatever) has a suitable map from "Actual values to coded values", typically by an initial algebra property of that domain). Alex says he thinks we don't need to go into detail on this.}

Finally, let us observe the naturality of this $\introN$. Consider the general form of its naturality squares:

\[\begin{tikzcd}
	\phi & \psi \\
	{\Hom_D(1, \introS(\phi))} & {\Hom_D(1, \introS(\psi))}
	\arrow["{\code{-}}"', from=1-1, to=2-1]
	\arrow["m", from=1-1, to=1-2]
	\arrow["{\code{-}}", from=1-2, to=2-2]
	\arrow["{\introS(m) \circ -}"', from=2-1, to=2-2]
\end{tikzcd}\]

This says that, for any definable unary formula $m(x)$, it is provably the case that for every $x$, we have that applying the function $m$ to $x$ and then constructing the term encoding the result ($\code{m(x)}$) is a provably equivalent term to taking the term representing $x$ and substituting it into the argument of the formula defining $m$ (what might be called $m(\code{x})$ or perhaps $\code{m}(\code{x})$ or at any rate $\introS(m)(\code{x})$). To be clear, by the provable equivalence of terms here, we do not mean syntactic identity as symbol-strings; rather, we mean that there is a provable equality sentence whose left and right sides are comprised of these terms. That is, whatever the actual result of the function $m$ on the input $x$ is, we must have that this is also provably the same as applying $m$ to the input $x$. Here, again, the $\Sigma_1$-ness of the formula defining $m$ comes to our rescue, telling us that truth entails provability in the appropriate way.

Thus, we obtain an introspective theory $\langle T, D, \introS, \introN \rangle$. This concludes our first example of an instrospective theory!

\bigskip
However, $\langle T, D, \introS, \introN \rangle$ is not actually the most typical introspective theory! It has special properties which we should not expect of a general introspective theory. Its internal $D$ acts as a perfect mirror image of $T$, and can thus itself be equipped as an internal introspective theory. The internal $D$ has in some informal sense no further objects (or morphisms, or equations) beyond the range of $\introS$. All of this is not typical for an introspective theory.

\begin{construction}
Let us describe now a more archetypal introspective theory, to guide the reader's intuitions better for how general introspective theories act.
\end{construction}

Throughout the construction of $T$, we have imposed a $\Sigma_1$ constraint on formulae. If we drop all such $\Sigma_1$ constraints and allow arbitrary formulae, we get by the same construction an analogous category $Z$. $T$ sits inside $Z$ as a subcategory (but not a full subcategory! The inclusion from $T$ into $Z$ is faithful, but not full).

Just as the construction of $T$ could itself be carried out in ZF-Finite to get a $D$ internal to $T$, so too can the construction of $Z$ can be carried out in ZF-Finite, to get a $C$ internal to $T$. Yes, this $C$ is internal to $T$, not just internal to $Z$! Even though $Z$ includes as its objects and morphisms formulae which are not $\Sigma_1$, the description of $Z$ (as a category whose objects are symbol-strings for which certain other symbol-strings exist, and whose morphisms are symbol-strings for which certain other symbol-strings exist, and so on) is $\Sigma_1$.

Finally, the inclusion of $T$ into $Z$ yields, analogously, an inclusion from $D$ into $C$, internal to $T$. This means the functor $\introS$ from $T$ into the global aspect of $D$ can just as well be thought of as having $C$ for its codomain, and similarly the natural transformation $\introN$ can just be well as thought of in this context.

Summarizing, we get an introspective theory $\langle T, C, \introS, \introN \rangle$, where $T$ is the category of $\Sigma_1$-definable hereditarily finite sets and $\Sigma_1$-definable functions between them up to provable equivalence, $C$ is the ($T$-internal) category of arbitrary definable sets and arbitrary definable functions between them up to provable equivalence, $\introS$ assigns to each piece of $T$ the corresponding (globally defined) piece of $C$, and $\introN$ is the definable function which sends any hereditarily finite set to the canonical term describing it, as well as witnessing the provable entailment from truth to provability for $\Sigma_1$ formulae.

Phew! What a long walk it was to get to describing that example! All the better, then, that we have formalized introspective theories so abstractly, and can work with them without having to fuss about such concrete details as in that example. But this is indeed the archetypal example it will be best to keep in mind to guide the reader's intuition throughout all further discussion.

\subsection{Variations from our core definition}
There are some slight variations on the concept of a (pre-)introspective theory which will occasionally be of use to us in future chapters, for technical reasons or for showing the greater generality of some results. In this section, we discuss such variations. But we remind the reader that our main object of interest is introspective theories. If ever this zoo of other named concepts grows intimidating, think always of introspective theories as the North Star.

\begin{definition}\label{DefnPreIntrospSNGeneralized}
Recall that a pre-introspective theory is a lexcategory $T$, a $T$-indexed lexcategory $C$, a lexfunctor $\introS$ from $T$ to the global aspect of $C$, and a natural transformation $\introN$ from $t$ in $T$ to $\Hom_C(1, \introS(t))$. Note how lex structure (that is, finite limit structure) is used throughout this definition.

More generally, for any notion of categorical structure extending the concept of a category-with-terminal-object, we may consider the situation of a category $T$ with such structure, a $T$-indexed category $C$ with such structure, a functor $\introS$ from $T$ to the global aspect of $C$ preserving such structure, and a natural transformation $\introN$ from $t$ in $T$ to $\Hom_C(1, \introS(t))$. In this way, we could speak of \defined{pre-introspective X theories} for various X; pre-introspective finite product theories, pre-introspective terminal object theories, pre-introspective countable limit theories, and so on.

But when we leave the nature of the theory unqualified, we always mean finite limits by default.

Note that whenever every instance of structure X is also an instance of structure Y, we will have that every pre-introspective X theory is also a pre-introspective Y theory.

Finally, on rare occasion it is even worthwhile to observe the extreme generality where we do not demand a terminal object. That is, a category $T$, a $T$-indexed category $C$, a functor $\introS$ from $T$ to the global aspect\footnote{Note that this global aspect is well-defined even if $T$ lacks a terminal object.} of $C$, a designated object $1$ in the global aspect of $C$ (not presumed terminal), and a map $\introN$ from $t$ to $\Hom_C(1, \introS(t))$, natural in $t$ in $T$. We shall call this a \defined{pre-introspective unary theory}.

Note that every pre-introspective terminal object theory can canonically be equipped as a pre-introspective unary theory by taking the designated object in $C$ to be its terminal object.

As ever, we may write out $\langle T, C, \introS, \introN \rangle$ or $\langle T, C, \introS, \introN, 1 \rangle$ to be fully explicit, but in typical abuse of language, will usually say $\langle T, C \rangle$ to describe a pre-introspective X theory.

When $C$ is small, we may call this an \defined{introspective X theory}. (We will only do this in contexts where it makes sense to speak of Xes internal to Xes. The minimal such context is when X is finite limit theories). 

When $C$ is locally small, we may call this a \defined{locally introspective X theory}. The most notable example of this is to speak of \defined{locally introspective finite product theories}. (Indeed, we will only use this terminology in contexts where a $T$-indexed locally small $X$ is taken to an $S$-indexed locally small $X$ by any $X$-homomorphism from $T$ to $S$, and the minimal such context is when X is finite product theories).
\end{definition}

There is one final definition we will need for technical reasons later on. Recall that a small indexed lexcategory is one which is equivalent to some small indexed strict lexcategory (with possibly multiple non-isomorphic such choices available). It is occasionally of use to imagine some particular such choice has been pinned down, leading to the following definition.

\begin{definition}
By an \defined{inner-strict introspective theory}, we mean an introspective theory $\langle T, C\rangle$ along with a specific choice for how to construe $C$ as an internal lexcategory; that is, a specific choice of $\Ob(C)$ as an object in $T$, as well as specific choices of internal maps equipping $C$ with chosen basic limits.
\end{definition}

Thus, an introspective theory can always be construed as some inner-strict introspective theory, though multiple non-isomorphic such choices may be available. \TODOinline{Cite how every small indexed non-strict lexcategory can become a small indexed strict lexcategory}

We call this \quote{inner strict} to emphasize that we've taken every choice concerning the representation of $C$ which was allowed to vary over non-isomorphic objects or non-equal parallel morphisms in $T$, and fixed some particular such choice for it, but we've not imposed strict structure on $T$ itself.

\subsection{Some useful constructions}
Now let us discuss some constructions for building new (pre-)introspective theories from old ones, or general tools for reasoning about (pre-)introspective theories.

\openNamedManualIndexSort{lemma}{$\introS$ Matches $\introN$}{S Matches N}\label{SMatchesN}
Within a pre-introspective terminal object theory $\langle T, C \rangle$, let $t$ be some object of $T$ and let $x$ be some globally defined element of $t$. Then $\introS(x)$ and $\introN_t(x)$ yield equal global elements of $S(t)$ within the global aspect of $C$.
\closeNamed{lemma}
\begin{proof}
Apply the naturality square for $\introN$ to the morphism $X$ from $1$ to $t$ representing $x$, as in the top square of this diagram.

\[\begin{tikzcd}
	1 && t \\
	\\
	{\Hom_C(1, \introS(1))} && {\Hom_C(1, \introS(t))} \\
	\\
	{\Hom_C(1, 1)}
	\arrow["{* \mapsto x}", from=1-1, to=1-3]
	\arrow["{\introN_t}", from=1-3, to=3-3]
	\arrow["{\Hom_C(1, \introS(* \mapsto x))}", from=3-1, to=3-3]
	\arrow["{\Hom_C(1, \iso)}"', tail reversed, from=3-1, to=5-1]
	\arrow["{(* \mapsto S(x)) \circ -}"', from=5-1, to=3-3]
	\arrow["{\introN_1}"', from=1-1, to=3-1]
\end{tikzcd}\]

Keep in mind, as $\introS$ preserves terminal objects, we have that $\Hom_C(1, \introS(1)) \iso \Hom_C(1, 1) \iso 1$, as in the three objects on the left of this diagram. These are all terminal objects of $T$, all isomorphic with unique morphisms to each other.

The path around the square along the top and right yields the morphism in $T$ from $1$ to $\Hom_C(1, \introS(t))$ representing $\introN_t(x)$. The path down the left of the diagram is the unique one from $1$ to $\Hom_C(1, 1)$, essentially picking out the identity morphism in $C$ on its terminal object. Finally, the bottom morphism of this diagram is the one which represents composition in $C$ with the morphism in $\Hom_C(1, \introS(t))$ representing $S(x)$ as a global element of $S(t)$. As composition with identity leaves values unchanged, the total path along the left and bottom of this diagram is the morphism from $1$ to $\Hom_C(1, \introS(t))$ representing $S(x)$. Thus, we may conclude that $S(x) = \introN_t(x)$.
\end{proof}

\begin{TODOblock}
It might be slightly confusing to call the above $C \Sigma$ when it is strictly speaking $C \op{\Sigma}$. Or it might be slightly confusing to speak about how $\Sigma$ should have a right adjoint, when $\op{\Sigma}$ is the real thing in play; the condition on $\op{\Sigma}$ is correspondingly for it to have a left adjoint. Notation/terminology is always such a bother...
\end{TODOblock}

\begin{construction}\label{IntrospInternalMap}
If $\langle T, C, \introF \rangle$ is a pre-introspective theory, and any lexfunctor $G : C \to D$ is given for some other $T$-indexed lexcategory $D$, then $\langle T, D, G \circ \introF \rangle$ is itself a pre-introspective theory, like so: 

\[\begin{tikzcd}
	{\op{T}} && {\LexCat}
	\arrow["{T/-}"{name=0}, from=1-1, to=1-3, shift left=5]
	\arrow["{C}"{name=1, description}, from=1-1, to=1-3]
	\arrow["{D}"{name=2, swap}, from=1-1, to=1-3, shift right=5]
	\arrow[Rightarrow, "{\introF}"', from=0, to=1]
	\arrow[Rightarrow, "{G}"', from=1, to=2]
\end{tikzcd}\]

Of course, this yields an introspective or locally introspective theory just in case $D$ is small or locally small, respectively.
\end{construction}

\begin{construction}\label{IntrospPullback}
If $\langle T, C, \introF \rangle$ is a pre-introspective theory, $U$ is any lexcategory, and $\Sigma: U \to T$ is any functor which preserves pullbacks (we do not require $\Sigma$ to preserve the terminal object), then $\langle U, \pullAlong{\Sigma} C \rangle$ can naturally be equipped as an introspective theory, like so:
\end{construction}
\begin{proof}[Details]
% https://q.uiver.app/?q=WzAsMyxbMCwwLCJcXG9we1V9Il0sWzIsMCwiXFxvcHtUfSJdLFs0LDAsIlxcTGV4Q2F0Il0sWzEsMiwiVC8tIiwwLHsib2Zmc2V0IjotMn1dLFsxLDIsIkMiLDIseyJvZmZzZXQiOjJ9XSxbMCwxLCJcXG9we1xcU2lnbWF9Il0sWzAsMiwiVS8tIiwwLHsib2Zmc2V0IjotNSwiY3VydmUiOi0zfV0sWzMsNCwiXFxpbnRyb0YiLDIseyJzaG9ydGVuIjp7InNvdXJjZSI6MjAsInRhcmdldCI6MjB9fV0sWzYsMSwiXFxTaWdtYSIsMCx7InNob3J0ZW4iOnsic291cmNlIjoyMH19XV0=
\[\begin{tikzcd}
	{\op{U}} && {\op{T}} && \LexCat
	\arrow[""{name=0, anchor=center, inner sep=0}, "{T/-}", shift left=2, from=1-3, to=1-5]
	\arrow[""{name=1, anchor=center, inner sep=0}, "C"', shift right=2, from=1-3, to=1-5]
	\arrow["{\op{\Sigma}}", from=1-1, to=1-3]
	\arrow[""{name=2, anchor=center, inner sep=0}, "{U/-}", shift left=5, curve={height=-18pt}, from=1-1, to=1-5]
	\arrow["\introF"', shorten <=1pt, shorten >=1pt, Rightarrow, from=0, to=1]
	\arrow["\Sigma", shorten <=3pt, Rightarrow, from=2, to=1-3]
\end{tikzcd}\]

The 2-cell labelled $\Sigma$ above indicates the action of $\Sigma$ when acting as a lexfunctor from $U/u$ to $T/(\Sigma u)$ for each object $u$ in $U$. (Note that, as finite limits in slice categories are given by pullbacks in the underlying category, and as $\Sigma$ preserves pullbacks, we do indeed have that this functor from $U/u$ to $T/(\Sigma u)$ preserves finite limits.)

By \cref{RepsmallRightAdjoint} or \cref{RepSmallRightAdjointFibers}, if $\Sigma$ has a right adjoint, we can further observe that if $C$ is small or locally small, then so respectively will be $\pullAlong{\Sigma} C$.
\end{proof}

A particular special case of the above which is often of importance is the following:

\begin{construction}\label{IntrospSlice}
If $\langle T, C, \introF \rangle$ is a pre-introspective theory, and $t$ is any object in $T$, then the slice category $T/t$ can be equipped in a natural way as a pre-introspective theory as well. If we start from an introspective or locally introspective theory, then so respectively will be the result of this construction.
\end{construction}
\begin{proof}[Details]
By the previous construction (\cref{IntrospPullback}), using the forgetful functor $\Sigma : T/t \to T$, which preserves pullbacks and has a right adjoint.
\end{proof}

When we abuse language and speak of $T/t$ as an introspective theory, the above construction is what we mean.

\begin{construction}\label{SubPreIntrosp}
If $\langle T, C, \introF \rangle$ is a pre-introspective theory, and $S$ is a full sub-lexcategory\footnote{That is, a full subcategory whose inclusion functor is a lexfunctor.} of $T$, then $\langle S, C, \introF \rangle$ is a pre-introspective theory, where we now consider $\introF$ as restricted to acting on $S$. This will be an introspective theory if $C$ itself lies within $S$.
\end{construction}
\begin{proof}[Details]
By \cref{IntrospPullback} again, taking $\Sigma$ to be the inclusion functor.
\end{proof}

\begin{construction}\label{SubCPreIntrosp}
If $\langle T, C, \introF \rangle$ is a pre-introspective theory, and $D$ is a full sub-lexcategory of $C$ containing the range of $\introF$, then $\langle T, D, \introF \rangle$ is a pre-introspective theory (where $\introF$ is now taken to have codomain $D$).
\end{construction}

The last two constructions are often fruitfully combined: Given a pre-introspective theory $\langle T, C, \introF \rangle$, we may first pass from $T$ to a sub-lexcategory $S$ of $T$ and then, after having done so, find that $\introF$ when restricted to $S$ factors through a sub-lexcategory $D$ of $C$.

\begin{TODOblock}
Make the useful observations that the theory of introspective theories is essentially lex, and that we can take therefore take products of introspective theories in the straightforward way. (We could also take limits of strict introspective theories more generally, but that involves talking about object equality, which we don't really want to do.). We can also take sub-introspective theories generated as the hull of subsets of their objects and morphisms, or other such free constructions.
\end{TODOblock}

\begin{construction}\label{TrivialPreIntrosp}
If $T$ is any lexcategory, it can be equipped as a pre-introspective theory, taking $C$ to be given by the self-indexing, and $\introS$ and $\introN$ to be the canonical isomorphisms of the appropriate type. (This is the same construction as discussed at \cref{TrivialPreIntrospIndexed}.)

This will be a locally introspective theory just in case $T$ is locally cartesian closed. However, it will be an introspective theory only in the trivial case that $T$ is the terminal category. This will follow from the categorical \Loeb's theorem we develop in the next chapter.

In the same way, if $T$ is any category with finite products, it can be equipped as a pre-introspective finite product theory, taking $C$ to be given by the simple self-indexing, and $\introS$ and $\introN$ to be the canonical isomorphisms of the appropriate type. This will be a locally introspective finite product theory just in case $T$ is cartesian closed.

\TODOinline{The constructions of the last two paragraphs are trivial and in a way a distraction, because our goal is introspective theories in the end, and these do not give us that. However, this way of looking at categories with finite products/CCCs/LCCCs is useful for drawing traditional corollaries of our general results.}
\end{construction}

\begin{observation}\label{CartesianClosedLocallyIntrosp}
The last construction can be much further generalized. Here we do so, using a number of observations:
\TODOinline{Move these wherever they actually belong}

Given a lex endofunctor $\Box$ under identity (that is, equipped with a natural transformation $\introN$ from identity to $\Box$) on a lex category $T$, we can automatically extend $\Box$ to a $T$-indexed lex endofunctor under identity on the self-indexing of $T$, taking the action on objects of $\Box_X$ on a slice $f : Y \to X$ above $X$ to be given by applying $\Box$ to $f$ to achieve a slice $\Box f : \Box Y \to \Box X$, then pulling this back along $\introN_Y : X \to \Box X$ to get another slice above $X$. The action on morphisms and the lexness of this construction are straightforward if tedious to show, as are the relevant functoriality and naturality conditions for this $\Box$ to be a well-defined $T$-indexed endofunctor \TODO.

This construction also works replacing lexness throughout by finite product structure and using the simple self-indexing correspondingly.

Furthermore, if $T$ is a cartesian closed category and $\Box$ is a finite product preserving endofunctor on $T$, we can obtain another cartesian closed category with the same objects as $T$ but in which a morphism from $A$ to $B$ is what had originally been a global section of $\Box (A \implies B)$, with the obvious composition structure.

The end result of these observations is that a pre-introspective cartesian closed theory in which $\introF$ is essentially surjective on objects amounts to essentially the same thing as a cartesian closed category $T$, a finite product preserving endofunctor $\Box$ on $T$, and a natural transformation $\introN$ from identity to $\Box$ on $T$. We take our category $C$ to be given by the construction of the last paragraph (taken as $T$-indexed by performing this relative to each aspect of the simple self-indexing of $T$), and we obtain $\introS$ by noting that a morphism from $A$ to $B$ in (any aspect of) $T$ corresponds to a global section of $A \implies B$, which can then be hit with $\Box$ to obtain a global section of $\Box (A \implies B)$. The result is automatically locally introspective.

Some version of this should apply as well to locally cartesian closed categories, but there's some bother about defining what the objects in the construction from two paragraphs ago should be, when they are given by equalizers in $C$ that don't already exist in $T$.

However, locally introspective (locally) cartesian closed theories cannot be fully introspective, or even just have the \Loeb\ property, except in a somewhat degenerate sense. $((\Box A) \implies A) \implies A$ will automatically be inhabited, as we have $(\Box A \implies A) \vdash \Box (\Box A \implies A)$ by $\introN$, which in turn entails $\Box A$ by \Loeb, and thus $(\Box A) \implies A \vdash A$. When $A$ is thought of as falsehood $0$, this amounts to $\neg \neg \Box 0$, asserting the double-negation of the inconsistency of $C$. In a Boolean context, this forces $C$ to be trivial.

\TODOinline{Write the analogue of this for geminal categories}
\end{observation}

\fileend